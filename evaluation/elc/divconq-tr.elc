range from to =
(if (<= from to)
    (cons from (range (+ from 1) to))
    nil)

inputstr =
"AAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHHAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHH"

times n lst =
(if (== n 0)
  nil
  (++ lst (times (- n 1) lst)))

divconq f lst =
(if (== (len lst) 0)
    (error "Empty list")
(if (== (len lst) 1)
    (head lst)
(if (== (len lst) 2)
    (f (item 0 lst)
       (item 1 lst))
(letrec mid = (floor (/ (len lst) 2))
        right = (- (len lst) mid)
in      (f (divconq f (sub 0 mid lst))
           (divconq f (sub mid right lst)))))))

main args =
(if (< (len args) 4)
    "Usage: divconq-tr.elc host port nitems itemsize\n"
(letrec host = (item 0 args)
        port = (stringtonum (item 1 args))
        nitems = (stringtonum (item 2 args))
        itemsize = (stringtonum (item 3 args))

        input = (times itemsize inputstr)

        callservice x y = (connect host port (++ x y))

        result = (divconq callservice (map (!x.input) (range 1 nitems)))

 in     (++ result "\nEND\n")))
