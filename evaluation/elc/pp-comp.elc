range from to =
(if (<= from to)
    (cons from (range (+ from 1) to))
    nil)

foldr f base lst =
(if lst
    (f (head lst) (foldr f base (tail lst)))
    base)

mkrequest n ms     = (++ (numtostring n) (++ " " (numtostring ms)))

parseresponse resp = (stringtonum (tail resp))

main args =
(if (< (len args) 5)
  "Usage: pp-comp.elc nitems nstages comp host port\n"
(letrec nitems = (stringtonum (item 0 args))
        nstages = (stringtonum (item 1 args))
        compms = (stringtonum (item 2 args))
        host = (item 3 args)
        port = (stringtonum (item 4 args))
        callservice n =
          (parseresponse (connect host port (mkrequest n compms)))
        f n x = (if (> n 0)
                    (callservice (f (- n 1) x))
                    x)
        result = (map (f nstages) (range 1 nitems))
 in     (foldr ++ "END\n" (map (!x.++ (numtostring x) "\n") result))))
