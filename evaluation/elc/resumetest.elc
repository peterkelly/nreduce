range from to =
(if (<= from to)
    (cons from (range (+ from 1) to))
    nil)

foldr f base lst =
(if lst
    (f (head lst) (foldr f base (tail lst)))
    base)

addnewline str =
(++ str "\n")

printstrings strings =
(foldr ++ "" (map addnewline strings))

parmap f lst =
(if lst
    (letrec
       newhead = (f (head lst))
       newtail = (parmap f (tail lst))
     in
       (par newhead
            (par newtail
                 (cons newhead newtail))))
    nil)

callservice !host !port !compms !n =
(connect host
         port
         (++ (numtostring n)
             (++ " " (numtostring compms))))

main args =
(if (< (len args) 2)
    "Usage: resumetest.elc host port\n"


(letrec host = (item 0 args)
        port = (stringtonum (item 1 args))


        first = (stringtonum (tail (callservice host port 1 9999)))

        results = (parmap (callservice host port 2000) (map (!x.first) (range 1 100)))

 in     (++ (printstrings results) "END\n")))
