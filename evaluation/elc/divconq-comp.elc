divconq f lst =
(if (== (len lst) 0)
    0
(if (== (len lst) 1)
    (head lst)
(if (== (len lst) 2)
    (f (item 0 lst)
       (item 1 lst))
(letrec mid = (floor (/ (len lst) 2))
        right = (- (len lst) mid)
in      (f (divconq f (sub 0 mid lst))
           (divconq f (sub mid right lst)))))))

mkrequest x y ms =
(++ (ntos (+ x y)) (++ " " (ntos ms)))

parseresponse resp =
(ston (tail resp))

main args =
(if (< (len args) 4)
    "Usage: divconq-comp.elc host port size comp\n"
(letrec host = (item 0 args)
        port = (ston (item 1 args))
        size = (ston (item 2 args))
        comp = (ston (item 3 args))
        callservice x y =
          (parseresponse (connect host port (mkrequest x y comp)))
        result = (divconq callservice (range 1 size))
 in     (++ (ntos result) "\nEND\n")))
