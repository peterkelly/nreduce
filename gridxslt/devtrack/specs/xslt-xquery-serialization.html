<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
<meta name="generator" content="HTML Tidy for Linux/x86 (vers 1st August 2004), see www.w3.org">


<title>XSLT 2.0 and XQuery 1.0 Serialization</title><style type="text/css">
/*<![CDATA[*/
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

div.issue
p.title        { margin-left: -2em; }

ol.enumar      { list-style-type: decimal; }
ol.enumla      { list-style-type: lower-alpha; }
ol.enumlr      { list-style-type: lower-roman; }
ol.enumua      { list-style-type: upper-alpha; }
ol.enumur      { list-style-type: upper-roman; }

li p           { margin-top: 0.3em;
                 margin-bottom: 0.3em; }

sup small      { font-style: italic;
                 color: #8F8F8F;
               }
    
div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}

div.issue { border-bottom-color: black;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            margin-bottom: 20pt;
}

th.issue-toc-head { border-bottom-color: black;
                    border-bottom-style: solid;
                    border-bottom-width: 1pt;
}

/*]]>*/
</style>
<link type="text/css" rel="stylesheet" href="serialization_files/W3C-WD.css"></head>


<body>
<div class="head">
<p><a href="http://www.w3.org/"><img alt="W3C" src="serialization_files/w3c_home.png" height="48" width="72"></a></p>
<h1><a id="title" name="title"></a>XSLT 2.0 and XQuery 1.0 Serialization</h1>
<h2><a id="w3c-doctype" name="w3c-doctype"></a>W3C Working Draft 4 April 2005</h2>
<dl>
<dt>This version:</dt>
<dd><a href="http://www.w3.org/TR/2005/WD-xslt-xquery-serialization-20050404/">http://www.w3.org/TR/2005/WD-xslt-xquery-serialization-20050404/</a></dd>
<dt>Latest version:</dt>
<dd><a href="http://www.w3.org/TR/xslt-xquery-serialization/">http://www.w3.org/TR/xslt-xquery-serialization/</a></dd>
<dt>Previous versions:</dt>
<dd><a href="http://www.w3.org/TR/2005/WD-xslt-xquery-serialization-20050211/">http://www.w3.org/TR/2005/WD-xslt-xquery-serialization-20050211/</a> <a href="http://www.w3.org/TR/2004/WD-xslt-xquery-serialization-20041029/">http://www.w3.org/TR/2004/WD-xslt-xquery-serialization-20041029/</a> <a href="http://www.w3.org/TR/2004/WD-xslt-xquery-serialization-20040723/">http://www.w3.org/TR/2004/WD-xslt-xquery-serialization-20040723/</a></dd>
<dt>Editors:</dt>
<dd>Michael Kay, Saxonica (formerly of Software AG) <a href="http://www.saxonica.com/">&lt;http://www.saxonica.com&gt;</a></dd>
<dd>Norman Walsh, Sun Microsystems <a href="mailto:Norman.Walsh@Sun.COM">&lt;Norman.Walsh@Sun.COM&gt;</a></dd>
<dd>Henry Zongaro, IBM <a href="mailto:zongaro@ca.ibm.com">&lt;zongaro@ca.ibm.com&gt;</a></dd>
<dd>Scott Boag, IBM <a href="mailto:scott_boag@us.ibm.com">&lt;scott_boag@us.ibm.com&gt;</a></dd>
<dd>Joanne Tong, IBM <a href="mailto:joannet@ca.ibm.com">&lt;joannet@ca.ibm.com&gt;</a></dd>
</dl>
<p>This document is also available in these non-normative formats: <a href="http://www.w3.org/TR/2005/WD-xslt-xquery-serialization-20050404/serialization.xml">XML</a>.</p>
<p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2005&nbsp;<a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.org/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>),
All Rights Reserved. W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>
</div>
<hr>
<div>
<h2><a id="abstract" name="abstract"></a>Abstract</h2>
<p>This document defines serialization of an instance of the data model as defined in <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a> into a sequence of octets. [<a title="host language" id="host-language" name="host-language">Definition</a>: Serialization is designed to be a component of a expanded a <b>host language</b> such as<a href="#xslt20">[XSL Transformations (XSLT) Version 2.0]</a> or <a href="#xquery">[XQuery 1.0: An XML Query Language]</a>.]</p>
</div>
<div>
<h2><a id="status" name="status"></a>Status of this Document</h2>
<p><em>This section describes the status of this document at the time
of its publication. Other documents may supersede this document. A list
of current W3C publications and the latest revision of this technical
report can be found in the <a href="http://www.w3.org/TR/">W3C technical reports index</a> at http://www.w3.org/TR/.</em></p>
<p>This is a Last Call Working Draft for review by W3C Members and
other interested parties. Publication as a Working Draft does not imply
endorsement by the W3C Membership. This is a draft document and may be
updated, replaced or obsoleted by other documents at any time. It is
inappropriate to cite this document as other than work in progress.</p>
<p>This document describes how <a href="#xslt20">[XSL Transformations (XSLT) Version 2.0]</a>, <a href="#xquery">[XQuery 1.0: An XML Query Language]</a> and other related XML standards convert an instance of the <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a> into a sequence of octets.</p>
<p>This draft reflects decisions taken up to and including the joint
meeting in Boston, MA during the week of February 28, 2005. These
decisions are recorded in the Last Call <a href="http://www.w3.org/2005/04/xquery-serialization-issues.html">issues list</a> (http://www.w3.org/2005/04/xquery-serialization-issues.html).</p>
<p>XSLT 2.0 and XQuery 1.0 Serialization has been defined jointly by the <a href="http://www.w3.org/Style/XSL/">XSL Working Group</a> and the <a href="http://www.w3.org/XML/Query">XML Query Working Group</a> (both part of the <a href="http://www.w3.org/XML/Activity.html">XML Activity</a>).</p>
<p>Public Last Call comments on this document are invited. Comments on
this document are due by 13 May 2005. Comments should be entered into
the last-call issue tracking system for this specification
(instructions can be found at <a href="http://www.w3.org/XML/2005/04/qt-bugzilla">http://www.w3.org/XML/2005/04/qt-bugzilla</a>). If access to that system is not feasible, you may send your comments to the W3C XSLT/XPath/XQuery mailing list, <a href="mailto:public-qt-comments@w3.org">public-qt-comments@w3.org</a> (archived at <a href="http://lists.w3.org/Archives/Public/public-qt-comments/">http://lists.w3.org/Archives/Public/public-qt-comments/</a>), with &#8220;[Serial]&#8221; at the beginning of the subject field.</p>
<p>The patent policy for this document is the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>. Patent disclosures relevant to this specification may be found on the <a href="http://www.w3.org/2002/08/xmlquery-IPR-statements">XML Query Working Group's patent disclosure page</a> and the <a href="http://www.w3.org/Style/XSL/Disclosures">XSL Working Group's patent disclosure page</a>. An individual who has actual knowledge of a patent which the individual
believes contains Essential Claim(s) with respect to this specification should disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.</p>
</div>
<div class="toc">
<h2><a id="contents" name="contents"></a>Table of Contents</h2>
<p class="toc">1 <a href="#intro">Introduction</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;1.1 <a href="#terminology">Terminology</a><br>
2 <a href="#serdm">Sequence Normalization</a><br>
3 <a href="#serparam">Serialization Parameters</a><br>
4 <a href="#serphases">Phases of Serialization</a><br>
5 <a href="#xml-output">XML Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;5.1 <a href="#XML_PARAMS">The Influence of Serialization Parameters upon the XML Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1 <a href="#XML_VERSION">XML Output Method: the version Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.2 <a href="#XML_ENCODING">XML Output Method: the encoding Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.3 <a href="#xml-indent">XML Output Method: the indent Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.4 <a href="#XML_CDATA-SECTION-ELEMENTS">XML Output Method: the cdata-section-elements Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.5 <a href="#XML_OMIT-XML-DECLARATION">XML Output Method: the omit-xml-declaration and standalone Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.6 <a href="#XML_DOCTYPE">XML Output Method: the doctype-system and doctype-public Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.7 <a href="#xml-undeclare-NS">XML Output Method: the undeclare-prefixes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.8 <a href="#XML_NORMALIZATION-FORM">XML Output Method: the normalization-form Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.9 <a href="#XML_MEDIA-TYPE">XML Output Method: the media-type Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.10 <a href="#XML_USE-CHARACTER-MAPS">XML Output Method: the use-character-maps Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.11 <a href="#XML_BYTE-ORDER-MARK">XML Output Method: the byte-order-mark Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.12 <a href="#XML_ESCAPE-URI-ATTRIBUTES">XML Output Method: the escape-uri-attributes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.13 <a href="#XML_INCLUDE-CONTENT-TYPE">XML Output Method: the include-content-type Parameter</a><br>
6 <a href="#xhtml-output">XHTML Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;6.1 <a href="#XHTML_PARAMS">The Influence of Serialization Parameters upon the XHTML Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.1 <a href="#XHTML_VERSION">XHTML Output Method: the version Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.2 <a href="#XHTML_ENCODING">XHTML Output Method: the encoding Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.3 <a href="#XHTML_INDENT">XHTML Output Method: the indent Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.4 <a href="#XHTML_CDATA-SECTION-ELEMENTS">XHTML Output Method: the cdata-section-elements Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.5 <a href="#XHTML_OMIT-XML-DECLARATION">XHTML Output Method: the omit-xml-declaration and standalone Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.6 <a href="#XHTML_DOCTYPE">XHTML Output Method: the doctype-system and doctype-public Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.7 <a href="#XHTML_UNDECLARE-PREFIXES">XHTML Output Method: the undeclare-prefixes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.8 <a href="#XHTML_NORMALIZATION-FORM">XHTML Output Method: the normalization-form Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.9 <a href="#XHTML_MEDIA-TYPE">XHTML Output Method: the media-type Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.10 <a href="#XHTML_USE-CHARACTER-MAPS">XHTML Output Method: the use-character-maps Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.11 <a href="#XHTML_BYTE-ORDER-MARK">XHTML Output Method: the byte-order-mark Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.12 <a href="#XHTML_ESCAPE-URI-ATTRIBUTES">XHTML Output Method: the escape-uri-attributes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.1.13 <a href="#XHTML_INCLUDE-CONTENT-TYPE">XHTML Output Method: the include-content-type Parameter</a><br>
7 <a href="#html-output">HTML Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;7.1 <a href="#N10E9A">Markup for Elements</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;7.2 <a href="#N10FA6">Writing Attributes</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;7.3 <a href="#N10FE9">Writing Character Data</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;7.4 <a href="#HTML_PARAMS">The Influence of Serialization Parameters upon the HTML Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.1 <a href="#HTML_VERSION">HTML Output Method: the version Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.2 <a href="#HTML_ENCODING">HTML Output Method: the encoding Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.3 <a href="#HTML_INDENT">HTML Output Method: the indent Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.4 <a href="#HTML_CDATA-SECTION-ELEMENTS">HTML Output Method: the cdata-section-elements Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.5 <a href="#HTML_OMIT-XML-DECLARATION">HTML Output Method: the omit-xml-declaration and standalone Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.6 <a href="#HTML_DOCTYPE">HTML Output Method: the doctype-system and doctype-public Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.7 <a href="#HTML_UNDECLARE-PREFIXES">HTML Output Method: the undeclare-prefixes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.8 <a href="#HTML_NORMALIZATION-FORM">HTML Output Method: the normalization-form Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.9 <a href="#HTML_MEDIA-TYPE">HTML Output Method: the media-type Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.10 <a href="#HTML_USE-CHARACTER-MAPS">HTML Output Method: the use-character-maps Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.11 <a href="#HTML_BYTE-ORDER-MARK">HTML Output Method: the byte-order-mark Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.12 <a href="#HTML_ESCAPE-URI-ATTRIBUTES">HTML Output Method: the escape-uri-attributes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.4.13 <a href="#HTML_INCLUDE-CONTENT-TYPE">HTML Output Method: the include-content-type Parameter</a><br>
8 <a href="#text-output">Text Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;8.1 <a href="#TEXT_PARAMS">The Influence of Serialization Parameters upon the Text Output Method</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.1 <a href="#TEXT_VERSION">Text Output Method: the version Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.2 <a href="#TEXT_ENCODING">Text Output Method: the encoding Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.3 <a href="#TEXT_INDENT">Text Output Method: the indent Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.4 <a href="#TEXT_CDATA-SECTION-ELEMENTS">Text Output Method: the cdata-section-elements Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.5 <a href="#TEXT_OMIT-XML-DECLARATION">Text Output Method: the omit-xml-declaration and standalone Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.6 <a href="#TEXT_DOCTYPE">Text Output Method: the doctype-system and doctype-public Parameters</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.7 <a href="#TEXT_UNDECLARE-PREFIXES">Text Output Method: the undeclare-prefixes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.8 <a href="#TEXT_NORMALIZATION-FORM">Text Output Method: the normalization-form Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.9 <a href="#TEXT_MEDIA-TYPE">Text Output Method: the media-type Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.10 <a href="#TEXT_USE-CHARACTER-MAPS">Text Output Method: the use-character-maps Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.11 <a href="#TEXT_BYTE-ORDER-MARK">Text Output Method: the byte-order-mark Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.12 <a href="#TEXT_ESCAPE-URI-ATTRIBUTES">Text Output Method: the escape-uri-attributes Parameter</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.1.13 <a href="#TEXT_INCLUDE-CONTENT-TYPE">Text Output Method: the include-content-type Parameter</a><br>
9 <a href="#character-maps">Character Maps</a><br>
10 <a href="#conformance">Conformance</a><br></p>
<h3><a id="appendices" name="appendices"></a>Appendices</h3>
<p class="toc">A <a href="#N113E8">References</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;A.1 <a href="#N113EB">Normative References</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;A.2 <a href="#N11564">Non-normative References</a><br>
B <a href="#id-errors">Summary of Error Conditions</a><br>
C <a href="#implementation-defined-features">Checklist of Implementation-Defined Features</a> (Non-Normative)<br></p>
</div>
<hr>
<div class="body">
<div class="div1">
<h2><a id="intro" name="intro"></a>1 Introduction</h2>
<p>This document defines serialization of the W3C XQuery 1.0 and XPath 2.0 Data Model, which is the data model of at least <a href="#xpath20">[XML Path Language (XPath) 2.0]</a>, <a href="#xslt20">[XSL Transformations (XSLT) Version 2.0]</a>, and <a href="#xquery">[XQuery 1.0: An XML Query Language]</a>, and any other specifications that reference it.</p>
<p>Serialization is the process of converting an instance of the <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a> into a sequence of octets. Serialization is well-defined for most data model instances.</p>
<div class="div2">
<h3><a id="terminology" name="terminology"></a>1.1 Terminology</h3>
<p>In this specification, where they appear in upper case, the words
"MUST", "MUST NOT", "SHOULD", "SHOULD NOT", "MAY", "REQUIRED", and
"RECOMMENDED" are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p>[<a title="serializer" id="serializer" name="serializer">Definition</a>: As is indicated in <a href="#conformance"><b>10 Conformance</b></a>, conformance criteria for serialization are determined by other specifications that refer to this specification. A <b>serializer</b>
is software that implements some or all of the requirements of this
specification in accordance with such conformance criteria.] A
serializer is not <strong>REQUIRED</strong> to directly provide a programming interface that permits a
user to set serialization parameters or to provide an input sequence for serialization.</p>
<p>Certain aspects of serialization are described in this specification as <a title="implementation-defined" href="#impdef">implementation-defined</a> or <a title="implementation-dependent" href="#impdep">implementation-dependent</a>.</p>
<p>[<a title="implementation-defined" id="impdef" name="impdef">Definition</a>: <b>Implementation-defined</b> indicates an aspect that <strong>MAY</strong> differ between <a title="serializer" href="#serializer">serializers</a>, but whose actual behaviour <strong>MUST</strong> be specified either by another specification that sets conformance criteria for serialization (see <a href="#conformance"><b>10 Conformance</b></a>) or in documentation that accompanies the <a title="serializer" href="#serializer">serializer</a>.]</p>
<p>[<a title="implementation-dependent" id="impdep" name="impdep">Definition</a>: <b>Implementation-dependent</b> indicates an aspect that <strong>MAY</strong> differ between <a title="serializer" href="#serializer">serializers</a>, and whose actual behaviour is not <strong>REQUIRED</strong> to be specified either by another specification that sets conformance criteria for serialization (see <a href="#conformance"><b>10 Conformance</b></a>) or in documentation that accompanies the <a title="serializer" href="#serializer">serializer</a>.]</p>
<p>[<a title="serialization error" id="serial-err" name="serial-err">Definition</a>:
In some instances, the sequence that is input to serialization cannot
be successfully converted into a sequence of octets given the set of
serialization parameter (<a href="#serparam"><b>3 Serialization Parameters</b></a>) values specified. A <b>serialization error</b> is said to occur in such an instance.] In some cases, a <a title="serializer" href="#serializer">serializer</a> is <strong>REQUIRED</strong> to signal such
an error. What it means to signal a serialization error is determined by the relevant conformance criteria (<a href="#conformance"><b>10 Conformance</b></a>) to which the <a title="serializer" href="#serializer">serializer</a> conforms. In other cases, there is an <a title="implementation-defined" href="#impdef">implementation-defined</a> choice between signalling a serialization error and performing a recovery action. Such a recovery action will allow a <a title="serializer" href="#serializer">serializer</a>
to produce a sequence of octets that might not fully reflect the usual
requirements of the parameter settings that are in effect.</p>
<p>Many terms used in this document are defined in the XPath specification <a href="#xpath20">[XML Path Language (XPath) 2.0]</a> or the Data Model specification <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a>. Particular attention is drawn to the following:</p>
<ul>
<li>
<p>[<a title="atomize" id="dt-atomization" name="dt-atomization">Definition</a>: The term <b>atomization</b> is defined in <a href="http://www.w3.org/TR/xpath20/#id-atomization">Section 2.4.2 Atomization</a><sup><small>XP</small></sup>. It is a process that takes as input a sequence of <a title="node" href="#dt-node">nodes</a> and <a href="http://www.w3.org/TR/xpath20/#dt-atomic-value">atomic values</a><sup><small>XP</small></sup>, and returns a sequence of <a href="http://www.w3.org/TR/xpath20/#dt-atomic-value">atomic values</a><sup><small>XP</small></sup>, in which the <a title="node" href="#dt-node">nodes</a> are replaced by their <a href="http://www.w3.org/TR/xpath20/#dt-typed-value">typed values</a><sup><small>XP</small></sup> as defined in <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a>.]</p>
</li>
<li>
<p>[<a title="node" id="dt-node" name="dt-node">Definition</a>: The term <b>Node</b> is defined as part of <a href="http://www.w3.org/TR/xpath-datamodel/#Node">Section 6 Nodes</a><sup><small>DM</small></sup>. There are seven kinds of <a title="node" href="#dt-node">nodes</a> in the data model: document, element, attribute, text, namespace, processing instruction, and comment.]</p>
</li>
<li>
<p>[<a title="sequence" id="dt-sequence" name="dt-sequence">Definition</a>: The term <b>sequence</b> is defined in <a href="http://www.w3.org/TR/xpath20/#id-basics">Section 2 Basics</a><sup><small>XP</small></sup>. A <a title="sequence" href="#dt-sequence">sequence</a> is an ordered collection of zero or more items.]</p>
</li>
<li>
<p>[<a title="string value" id="dt-string-value" name="dt-string-value">Definition</a>: The term <b>string value</b> is defined in <a href="http://www.w3.org/TR/xpath-datamodel/#dm-string-value">Section 5.13 string-value Accessor</a><sup><small>DM</small></sup>. Every <a title="node" href="#dt-node">node</a> has a <a title="string value" href="#dt-string-value">string value</a>. For example, the <a title="string value" href="#dt-string-value">string value</a> of an element is the concatenation of the
<a title="string value" href="#dt-string-value">string values</a> of all its descendant text <a title="node" href="#dt-node">nodes</a>.]</p>
</li>
<li>
<p>[<a title="expanded QName" id="dt-expanded-qname" name="dt-expanded-qname">Definition</a>: The term <b>expanded QName</b> is defined in <a href="http://www.w3.org/TR/xpath20/#id-basics">Section 2 Basics</a><sup><small>XP</small></sup>. An <a title="expanded QName" href="#dt-expanded-qname">expanded QName</a> consists of an optional namespace URI and a local name. An <a title="expanded QName" href="#dt-expanded-qname">expanded QName</a> also retains its original namespace prefix (if any), to facilitate
casting the expanded QName into a string.]</p>
</li>
<li>
<p>[<a title="null namespace URI" id="null-namespace-URI" name="null-namespace-URI">Definition</a>: An element or attribute that is in no namespace, or an <a title="expanded QName" href="#dt-expanded-qname">expanded-QName</a> whose namespace part is an empty sequence, is referred to as having a <b>null namespace URI</b>].</p>
</li>
<li>
<p>[<a title="non-null namespace URI" id="non-null-namespace-URI" name="non-null-namespace-URI">Definition</a>: An element or attribute that does not hava a <a title="null namespace URI" href="#null-namespace-URI">null namespace URI</a>, is referred to as having a <b>non-null namespace URI</b>].</p>
</li>
</ul>
</div>
</div>
<div class="div1">
<h2><a id="serdm" name="serdm"></a>2 Sequence Normalization</h2>
<p>An instance of the data model that is input to the serialization
process is a sequence. Prior to serializing a sequence using any of the
output methods whose behavior is specified by this document (<a href="#serparam"><b>3 Serialization Parameters</b></a>) the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> first compute a normalized sequence for serialization; it is the normalized sequence that is actually serialized. [<a title="sequence normalization" id="sequence-normalization" name="sequence-normalization">Definition</a>: The purpose of <b>sequence normalization</b>
is to create a sequence that can be serialized as a well-formed XML
document or external general parsed entity, that also reflects the
content of the input sequence to the extent possible.] [<a title="result tree" id="result-tree" name="result-tree">Definition</a>: The result of the <a title="sequence normalization" href="#sequence-normalization">sequence normalization</a> process is a
<b>result tree</b>.]</p>
<p>The normalized sequence for serialization is constructed by applying
all of the following rules in order, with the initial sequence being
input to the first step, and the sequence that results from any step
being used as input to the subsequent step. For any <a title="implementation-defined" href="#impdef">implementation-defined</a> output method, it is <a title="implementation-defined" href="#impdef">implementation-defined</a> whether this sequence normalization process takes place.</p>
<p>Where the process of converting the input sequence to a normalized sequence indicates that a value <strong>MUST</strong> be cast to <code>xs:string</code>, that operation is as defined in <a href="http://www.w3.org/TR/xpath-functions/#casting-to-string">Section 17.1.2 Casting to xs:string and xdt:untypedAtomic</a><sup><small>FO</small></sup> of <a href="#xpath-functions">[XQuery 1.0 and XPath 2.0 Functions and Operators]</a>. The steps in computing the normalized sequence are:</p>
<ol class="enumar">
<li>
<p>If the sequence that is input to serialization is empty, create a sequence <em>S<sub>1</sub></em>
that consists of a zero-length string. Otherwise, copy each item in the
sequence that is input to serialization to create the new sequence <em>S<sub>1</sub></em>.</p>
</li>
<li>
<p>For each item in <em>S<sub>1</sub></em>, if the item is atomic, obtain the lexical representation of the item by casting it to an <code>xs:string</code> and copy the string representation to the new sequence; otherwise, copy the item, which will be a <a title="node" href="#dt-node">node</a>, to the new sequence. The new sequence is <em>S<sub>2</sub></em>.</p>
</li>
<li>
<p>For each subsequence of adjacent strings in <em>S<sub>2</sub></em>,
copy a single string to the new sequence equal to the values of the
strings in the subsequence concatenated in order, each separated by a
single space. Copy all other items to the new sequence. The new
sequence is <em>S<sub>3</sub></em>.</p>
</li>
<li>
<p>For each item in <em>S<sub>3</sub></em>, if the item is a string, create a text <a title="node" href="#dt-node">node</a> in the new sequence whose <a title="string value" href="#dt-string-value">string value</a> is equal to the string; otherwise, copy the item to the new sequence. The new sequence is <em>S<sub>4</sub></em>.</p>
</li>
<li>
<p>For each item in <em>S<sub>4</sub></em>, if the item is a document <a title="node" href="#dt-node">node</a>, copy its children to the new sequence; otherwise, copy the item to the new sequence. The new sequence is <em>S<sub>5</sub></em>.</p>
</li>
<li>
<p>For each subsequence of adjacent text nodes in <em>S<sub>5</sub></em>,
copy a single text node to the new sequence equal to the values of the
text nodes in the subsequence concatenated in order. Any text nodes
with values of zero length are dropped. Copy all other items to the new
sequence. The new sequence is <em>S<sub>6</sub></em>.</p>
</li>
<li>
<p>It is a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0001" href="#ERRSE0001">err:SE0001</a>] if an item in <em>S<sub>6</sub></em> is an attribute <a title="node" href="#dt-node">node</a> or a namespace <a title="node" href="#dt-node">node</a>. Otherwise, construct a new sequence, <em>S<sub>7</sub></em>, that consists of a single document <a title="node" href="#dt-node">node</a> and copy all the items in the sequence, which are all <a title="node" href="#dt-node">nodes</a>, as children of that document <a title="node" href="#dt-node">node</a>.</p>
</li>
</ol>
<p><em>S<sub>6</sub></em> is the normalized sequence.</p>
<p>The <a title="result tree" href="#result-tree">result tree</a> rooted at the document <a title="node" href="#dt-node">node</a>
that is created by the final step of this sequence normalization
process is the instance of the data model to which the rules of the
appropriate output method are applied. If the sequence normalization
process results in a <a title="serialization error" href="#serial-err">serialization error</a>, the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong>
signal the error.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The sequence normalization process for a sequence <code>$seq</code> is equivalent to constructing a document <a title="node" href="#dt-node">node</a> using the XSLT instruction:</p>
<div class="exampleInner">
<pre>&lt;xsl:document&gt;
  &lt;xsl:copy-of select="$seq"/&gt;
&lt;/xsl:document&gt;
</pre></div>
<p>or the XQuery expression:</p>
<div class="exampleInner">
<pre>document {
  for $s in $seq return
    if ($s instance of document-node())
    then $s/child::node()
    else $s
}
</pre></div>
<p>This process results in a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0001" href="#ERRSE0001">err:SE0001</a>] with sequences containing parentless attribute and namespace <a title="node" href="#dt-node">nodes</a>.</p>
</div>
</div>
<div class="div1">
<h2><a id="serparam" name="serparam"></a>3 Serialization Parameters</h2>
<p>There are a number of parameters that influence how serialization is performed. <a title="host language" href="#host-language">Host languages</a> <strong>MAY</strong> allow users to specify any or all of these parameters, but they are not <strong>REQUIRED</strong> to be able to do so. However, the <a title="host language" href="#host-language">host language</a> specification <strong>MUST</strong> specify how the value of all applicable parameters is to be determined.</p>
<p>It is a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0016" href="#ERRSE0016">err:SE0016</a>] if a parameter value is invalid for the given parameter. It is the responsibility of the <a title="host language" href="#host-language">host language</a> to specify how invalid values should be handled at the level of that language.</p>
<p>The following serialization parameters are defined:</p>
<table summary="Serialization parameters" border="1">
<col span="1" width="180">
<col span="1">
<thead>
<tr>
<th align="left">Serialization parameter name</th>
<th align="left">Permitted values for parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>byte-order-mark</code></td>
<td>One of the enumerated values <code>yes</code> or <code>no</code>.
This parameter indicates whether the serialized sequence of octects is
to be preceded by a Byte Order Mark. (See Section 5.1 of <a href="#UNICODE-ENCODING">[Unicode Encoding]</a>.) The actual octet order used is <a title="implementation-dependent" href="#impdep">implementation-dependent</a>. If the concept of a Byte Order Mark is not meaningful in connection with the value of the <code>encoding</code> parameter, the
<code>byte-order-mark</code> parameter is ignored.</td>
</tr>
<tr>
<td><code>cdata-section-elements</code></td>
<td>A list of expanded QNames, possibly empty.</td>
</tr>
<tr>
<td><code>doctype-public</code></td>
<td>A string of Unicode characters. This parameter may be absent.</td>
</tr>
<tr>
<td><code>doctype-system</code></td>
<td>A string of Unicode characters. This parameter may be absent.</td>
</tr>
<tr>
<td><code>encoding</code></td>
<td>A string of Unicode characters in the range #x21 to #x7E (that is, printable ASCII characters); the value <strong>SHOULD</strong> be a charset registered with the Internet Assigned Numbers Authority <a href="#IANA">[IANA]</a>, <a href="#RFC2278">[RFC2278]</a> or begin with the characters <code>x-</code> or <code>X-</code>.</td>
</tr>
<tr>
<td><code>escape-uri-attributes</code></td>
<td>One of the enumerated values <code>yes</code> or <code>no</code>.</td>
</tr>
<tr>
<td><code>include-content-type</code></td>
<td>One of the enumerated values <code>yes</code> or <code>no</code>.</td>
</tr>
<tr>
<td><code>indent</code></td>
<td>One of the enumerated values <code>yes</code> or <code>no</code>.</td>
</tr>
<tr>
<td><code>media-type</code></td>
<td>A string of Unicode characters specifying the media type (MIME content type) <a href="#RFC2046">[RFC2046]</a>; the charset parameter of the media type <strong>MUST NOT</strong> be specified explicitly in the value of the <code>media-type</code> parameter. If the destination of the serialized output is annotated with a media type, this parameter <strong>MAY</strong> be used to provide such an annotation. For example, it <strong>MAY</strong> be used to set the media type in an HTTP header.</td>
</tr>
<tr>
<td><code>method</code></td>
<td>An expanded QName with a <a title="null namespace URI" href="#null-namespace-URI">null namespace URI</a>, and the local part of the name equal to one of <code>xml</code>, <code>xhtml</code>, <code>html</code> or <code>text</code>, or having a <a title="non-null namespace URI" href="#non-null-namespace-URI">non-null namespace URI</a>. If the namespace URI is non-null, the parameter specifies an <a title="implementation-defined" href="#impdef">implementation-defined</a> output method.</td>
</tr>
<tr>
<td><code>normalization-form</code></td>
<td>One of the enumerated values <code>NFC</code>, <code>NFD</code>, <code>NFKC</code>, <code>NFKD</code>, <code>fully-normalized</code>, <code>none</code> or an <a title="implementation-defined" href="#impdef">implementation-defined</a> value.</td>
</tr>
<tr>
<td><code>omit-xml-declaration</code></td>
<td>One of the enumerated values <code>yes</code> or <code>no</code>.</td>
</tr>
<tr>
<td><code>standalone</code></td>
<td>One of the enumerated values <code>yes</code>, <code>no</code> or <code>omit</code>.</td>
</tr>
<tr>
<td><code>undeclare-prefixes</code></td>
<td>One of the enumerated values <code>yes</code> or <code>no</code>.</td>
</tr>
<tr>
<td><code>use-character-maps</code></td>
<td>A list of pairs, possibly empty, with each pair consisting of a single Unicode character and a string of Unicode characters.</td>
</tr>
<tr>
<td><code>version</code></td>
<td>A string of Unicode characters.</td>
</tr>
</tbody>
</table>
<p>The value of the <code>method</code> parameter is an <a title="expanded QName" href="#dt-expanded-qname">expanded QName</a>. If the value has a <a title="null namespace URI" href="#null-namespace-URI">null namespace URI</a>, then the local name identifies a method specified in this document and <strong>MUST</strong> be one of <code>xml</code>, <code>html</code>, <code>xhtml</code>, or <code>text</code>; in this case, the output method specified <strong>MUST</strong> be used for serializing. If the
namespace URI is non-null, then it identifies an <a title="implementation-defined" href="#impdef">implementation-defined</a> output method; the behavior in this case is not specified by this document.</p>
<p>In those cases where they have no important effect on the content of
the serialized result, details of the output methods defined by this
specification are left unspecified and are regarded as <a title="implementation-dependent" href="#impdep">implementation-dependent</a>. Whether a <a title="serializer" href="#serializer">serializer</a> uses apostrophes or quotation marks to delimit attribute values in the XML output method is an example of such a detail.</p>
<p>The detailed semantics of each parameter will be described separately for each output method <span>for which it is applicable</span>. <span>If the semantics of a parameter are not described for an output method, then it is not applicable to that output method.</span></p>
</div>
<div class="div1">
<h2><a id="serphases" name="serphases"></a>4 Phases of Serialization</h2>
<p>Following the sequence normalization process described in <a href="#serdm"><b>2 Sequence Normalization</b></a>, serialization can be regarded as involving three phases of processing.</p>
<p>For an <a title="implementation-defined" href="#impdef">implementation-defined</a> output method, any of these phases <strong>MAY</strong> be skipped or <strong>MAY</strong>
be performed in a different order than is specified here. For the
output methods defined in this specification, these phases are carried
out sequentially as follows:</p>
<ol class="enumar">
<li>
<p><em>Markup generation</em> produces the character representation of
those parts of the serialized result that describe the structure of the
normalized sequence. In the cases of the XML, HTML and XHTML output
methods, this phase produces the character representations of the
following:</p>
<ul>
<li>
<p>the document type declaration;</p>
</li>
<li>
<p>start tags and end tags (except for attribute values, whose representation is produced by the character expansion phase);</p>
</li>
<li>
<p>processing instructions; and</p>
</li>
<li>
<p>comments.</p>
</li>
</ul>
<p>In the cases of the XML and XHTML output methods, this phase also produces the following:</p>
<ul>
<li>
<p>the XML or text declaration; and</p>
</li>
<li>
<p>empty element tags (except for the attribute values);</p>
</li>
</ul>
In the case of the text output method, this phase has no effect.</li>
<li>
<p><em>Character expansion</em> is concerned with the representation of characters appearing in text and attribute <a title="node" href="#dt-node">nodes</a>
in the normalized sequence. The substitution processes that apply are
listed below, in priority order: a character that is handled by one
process in this list will be unaffected by processes appearing later in
the list, except that a character affected by <a title="Unicode Normalization" href="#unicode-normalization">Unicode Normalization</a>
<strong>MAY</strong> be affected by creation of CDATA sections and by character escaping:</p>
<ol class="enumla">
<li>
<p><a title="URI Escaping" href="#uri-escaping">URI escaping</a> (in the case of URI-valued attributes in the HTML and XHTML output methods), as determined by the <code>escape-uri-attributes</code> parameter. [<a title="URI Escaping" id="uri-escaping" name="uri-escaping">Definition</a>: <b>URI escaping</b> is a process where non-ASCII characters in URI attribute values are escaped using the method defined by Section 5.4 of <a href="#XLINK">[XLink]</a>.]</p>
</li>
<li>
<p>Character mapping, as determined by the <code>use-character-maps</code> parameter. Text <a title="node" href="#dt-node">nodes</a> that are children of elements specified by the <code>cdata-section-elements</code> parameter are not affected by this step.</p>
</li>
<li>
<p><a title="Unicode Normalization" href="#unicode-normalization">Unicode Normalization</a>, if requested by the <code>normalization-form</code> parameter. [<a title="Unicode Normalization" id="unicode-normalization" name="unicode-normalization">Definition</a>: <b>Unicode Normalization</b>
is the process of removing alternate representations of equivalent
sequences from textual data, to convert the data into a form that can
be binary-compared for equivalence, as specified in <a href="#UNICODE-NORMALIZATION">[UAX #15: Unicode Normalization Forms]</a>. For specific recommendations for character normalization on the World Wide Web, see <a href="#CHARMOD">[Character Model for the World Wide Web 1.0: Normalization]</a>.]</p>
<p>The meanings associated with the possible values of the <code>normalization-form</code> parameter are as follows:</p>
<ul>
<li>
<p><code>NFC</code> specifies the serialized result will be in Normalization Form C, using the rules specified in <a href="#CHARMOD">[Character Model for the World Wide Web 1.0: Normalization]</a>.</p>
</li>
<li>
<p><code>NFD</code> specifies the serialized result will be in Normalization Form D, as specified in <a href="#UNICODE-NORMALIZATION">[UAX #15: Unicode Normalization Forms]</a>.</p>
</li>
<li>
<p><code>NFKC</code> specifies the serialized result will be in Normalization Form KC, as specified in <a href="#UNICODE-NORMALIZATION">[UAX #15: Unicode Normalization Forms]</a>.</p>
</li>
<li>
<p><code>NFKD</code> specifies the serialized result will be in Normalization Form KD, as specified in <a href="#UNICODE-NORMALIZATION">[UAX #15: Unicode Normalization Forms]</a>.</p>
</li>
<li>
<p><code>fully-normalized</code> specifies the serialized result will be in fully normalized text, as specified in <a href="#CHARMOD">[Character Model for the World Wide Web 1.0: Normalization]</a>.</p>
</li>
<li>
<p><code>none</code> specifies that no <a title="Unicode Normalization" href="#unicode-normalization">Unicode Normalization</a> will be applied.</p>
</li>
<li>
<p>An <a title="implementation-defined" href="#impdef">implementation-defined</a> value has an <a title="implementation-defined" href="#impdef">implementation-defined</a> effect.</p>
</li>
</ul>
</li>
<li>
<p>Creation of CDATA sections, as determined by the <code>cdata-section-elements</code> parameter. Note that this is also affected by the <code>encoding</code> parameter, in that characters not present in the selected encoding cannot be represented in a CDATA section.</p>
</li>
<li>
<p>Escaping according to XML or HTML rules of special characters that
cannot be represented in the selected encoding. For example replacing <code>&lt;</code> with <code>&amp;lt;</code></p>
</li>
<li>
<p>If a quote (<code>"</code>) character is in an attribute, and the
attribute is delimited by quote, the character will be changed to an an
apostrophe ('). Likewise, if a apostrophe (<code>'</code>) character is in an attribute, and the attribute is delimited by apostrophe, the character will be changed to an an quote (").</p>
</li>
</ol>
</li>
<li>
<p><em>Encoding</em>, as controlled by the <code>encoding</code> parameter, converts the character stream produced by the previous phases into a octet stream.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Serialization is only defined in terms of encoding the result as a stream of octets. However, a <a title="serializer" href="#serializer">serializer</a>
may provide an option that allows the encoding phase to be skipped, so
that the result of serialization is a stream of Unicode characters. The
effect of any such option is <a title="implementation-defined" href="#impdef">implementation-defined</a>, and a <a title="serializer" href="#serializer">serializer</a> is not required to support such an
option.</p>
</div>
</li>
</ol>
</div>
<div class="div1">
<h2><a id="xml-output" name="xml-output"></a>5 XML Output Method</h2>
<p>The XML output method serializes the normalized sequence as an XML entity that <strong>MUST</strong> satisfy the rules for either a well-formed XML document entity or a well-formed XML external general parsed entity, or both. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0003" href="#ERRSE0003">err:SE0003</a>] results if the <a title="serializer" href="#serializer">serializer</a> is unable to satisfy those rules, except for contents modified by the
character expansion phase of serialization, as described in <a href="#serphases"><b>4 Phases of Serialization</b></a>, which could result in the serialized output being not well-formed but will not result in a <a title="serialization error" href="#serial-err">serialization error</a>. If a <a title="serialization error" href="#serial-err">serialization error</a> results, the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
<p>If the document <a title="node" href="#dt-node">node</a> of the normalized sequence has a single element <a title="node" href="#dt-node">node</a> child and no text <a title="node" href="#dt-node">node</a> children, then the serialized output is a well-formed XML document entity, and the serialized output <strong>MUST</strong> conform to the appropriate version of the XML Namespaces Recommendation <a href="#XMLNAMES">[XML Names]</a> or <a href="#XMLNAMES11">[XML Names 1.1]</a>.
If the normalized sequence
does not take this form, then the serialized output is a well-formed
XML external general parsed entity, which, when referenced within a
trivial XML document wrapper like this:</p>
<div class="exampleInner">
<pre>
&lt;?xml version="<em>version</em>"?&gt;
&lt;!DOCTYPE doc [
&lt;!ENTITY e SYSTEM "<em>entity-URI</em>"&gt;
]&gt;
&lt;doc&gt;&amp;e;&lt;/doc&gt;
</pre></div>
<p>where <code>entity-URI</code> is a URI for the entity, and the value of the <code>version</code> pseudo-attribute is the value of the <code>version</code> parameter, produces a document which <strong>MUST</strong> itself be a well-formed XML document conforming to the corresponding version of the XML Namespaces Recommendation <a href="#XMLNAMES">[XML Names]</a> or <a href="#XMLNAMES11">[XML Names 1.1]</a>.</p>
<p>[<a title="reconstructed tree" id="reconstructed-tree" name="reconstructed-tree">Definition</a>: A <b>reconstructed tree</b> may be constructed by parsing the XML document and converting it into an instance of the data model as specified in <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a>.] The result of serialization <strong>MUST</strong> be such that the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> may be different than the <a title="result tree" href="#result-tree">result tree</a> as follows:</p>
<ul>
<li>
<p>If the document was produced by adding a document wrapper, as described above, then it will contain an extra <code>doc</code> element as the document element.</p>
</li>
<li>
<p>The order of attribute and namespace <a title="node" href="#dt-node">nodes</a> in the two trees <strong>MAY</strong> be different.</p>
</li>
<li>
<p>The following properties of corresponding <a title="node" href="#dt-node">nodes</a> in the two trees <strong>MAY</strong> be different:</p>
<ul>
<li>
<p>the base-uri property of document <a title="node" href="#dt-node">nodes</a> and element <a title="node" href="#dt-node">nodes</a>;</p>
</li>
<li>
<p>the document-uri and unparsed-entities properties of document <a title="node" href="#dt-node">nodes</a>;</p>
</li>
<li>
<p>the type-name and typed-value properties of element and attribute <a title="node" href="#dt-node">nodes</a>;</p>
</li>
<li>
<p>the nilled property of element <a title="node" href="#dt-node">nodes</a>;</p>
</li>
<li>
<p>the content property of text <a title="node" href="#dt-node">nodes</a>, due to the effect of the <code>indent</code> and <code>use-character-maps</code> parameters.</p>
</li>
</ul>
</li>
<li>
<p>The <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> <strong>MAY</strong> contain additional attributes and text <a title="node" href="#dt-node">nodes</a> resulting from the expansion of default and fixed values in its DTD or schema.</p>
</li>
<li>
<p>The type annotations of the <a title="node" href="#dt-node">nodes</a> in the two trees <strong>MAY</strong> be different. Type annotations in a <a title="result tree" href="#result-tree">result tree</a>
are discarded when the tree is serialized. Any new type annotations
obtained by parsing the document will depend on whether the serialized
XML document is assessed against a schema, and this <strong>MAY</strong> result in type annotations that are different from those in the original <a title="result tree" href="#result-tree">result tree</a>.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>In order to influence the type annotations in the instance of the
data model that would result from processing a serialized XML document,
the author of the XSLT stylesheet, XQuery expression or other process
might wish to create the instance of the data model that is input to
the serialization process so that it makes use of mechanisms provided
by <a href="#XMLSCHEMA">[XML Schema]</a>, such as <code>xsi:type</code> and <code>xsi:schemaLocation</code> attributes. The serialization process will not
automatically create such attributes in the serialized document if those attributes were not part of the <a title="result tree" href="#result-tree">result tree</a> that is to be serialized.</p>
<p>Similarly, it is possible that an element <a title="node" href="#dt-node">node</a> in the instance of the data model that is to be serialized has the <code>nilled</code> property with the value <code>true</code>, but no <code>xsi:nil</code>
attribute. The serialization process will not create such an attribute
in the serialized document simply to reflect the value of the property.
The value of the <code>nilled</code> property has no direct effect on the serialized result.</p>
</div>
</li>
<li>
<p>Additional namespace <a title="node" href="#dt-node">nodes</a> <strong>MAY</strong> be present in the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> if the serialization process did not undeclare one or more namespaces, as described in <a href="#xml-undeclare-NS"><b>5.1.7 XML Output Method: the undeclare-prefixes Parameter</b></a>, and the starting instance of the data model contained an element <a title="node" href="#dt-node">node</a> with a namespace <a title="node" href="#dt-node">node</a> that declared some prefix, but a child element of that <a title="node" href="#dt-node">node</a> did not have any namespace <a title="node" href="#dt-node">node</a> that declared the same prefix.</p>
<p>The <a title="result tree" href="#result-tree">result tree</a> <strong>MAY</strong> contain namespace <a title="node" href="#dt-node">nodes</a> that are not present in the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a>, as the process of creating an instance of the data model <strong>MAY</strong> ignore namespace declarations in some circumstances. See <a href="http://www.w3.org/TR/xpath-datamodel/#const-infoset-element">Section 6.2.3 Construction from an
Infoset</a><sup><small>DM</small></sup> and <a href="http://www.w3.org/TR/xpath-datamodel/#const-psvi-element">Section 6.2.4 Construction from a PSVI</a><sup><small>DM</small></sup> of <a href="#xpath-datamodel">[XQuery 1.0 and XPath 2.0 Data Model]</a> for additional information.</p>
</li>
<li>
<p>If the <code>indent</code> parameter has the value <code>yes</code>,</p>
<ul>
<li>
<p>additional text <a title="node" href="#dt-node">nodes</a> consisting of whitespace characters <strong>MAY</strong> be present in the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a>; and</p>
</li>
<li>
<p>text <a title="node" href="#dt-node">nodes</a> in the <a title="result tree" href="#result-tree">result tree</a> that contained only whitespace characters <strong>MAY</strong> correspond to text <a title="node" href="#dt-node">nodes</a> in the<a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> that contain additional whitespace characters that were not present in the <a title="result tree" href="#result-tree">result tree</a></p>
</li>
</ul>
<p>See <a href="#xml-indent"><b>5.1.3 XML Output Method: the indent Parameter</b></a> for more information on the <code>indent</code> parameter.</p>
</li>
<li>
<p>Additional <a title="node" href="#dt-node">nodes</a> <strong>MAY</strong> be present in the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> due to the effect of character mapping in the character expansion phase, and the values of attribute <a title="node" href="#dt-node">nodes</a> and text <a title="node" href="#dt-node">nodes</a> in the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> <strong>MAY</strong> be different from those in the
<a title="result tree" href="#result-tree">result tree</a>, due to the effects of URI expansion, character mapping and <a title="Unicode Normalization" href="#unicode-normalization">Unicode Normalization</a> in the character expansion phase of serialization.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <code>use-character-maps</code> parameter can cause arbitrary
characters to be inserted into the serialized XML document in an
unescaped form, including characters that would be considered to be
part of XML markup. Such characters could result in arbitrary new
element <a title="node" href="#dt-node">nodes</a>, attribute <a title="node" href="#dt-node">nodes</a>, and so on, in the <a title="reconstructed tree" href="#reconstructed-tree">reconstructed tree</a> that results from processing the
serialized XML document.</p>
</div>
<p>A consequence of this rule is that certain characters <strong>MUST</strong>
be output as character references, to ensure that they survive the
round trip through serialization and parsing. Specifically, CR, NEL and
LINE SEPARATOR characters in text <a title="node" href="#dt-node">nodes</a> <strong>MUST</strong> be output respectively as "<code>&amp;#xD;</code>", "<code>&amp;#x85;</code>", and "<code>&amp;#x2028;</code>", or their equivalents; while CR, NL, TAB, NEL and LINE SEPARATOR characters in
attribute <a title="node" href="#dt-node">nodes</a> <strong>MUST</strong> be output respectively as "<code>&amp;#xD;</code>", "<code>&amp;#xA;</code>", "<code>&amp;#x9;</code>", "<code>&amp;#x85;</code>", and "<code>&amp;#x2028;</code>", or their equivalents. In addition, the non-whitespace control characters #x1 through #x1F and #x7F through #x9F in text <a title="node" href="#dt-node">nodes</a> and attribute <a title="node" href="#dt-node">nodes</a> <strong>MUST</strong> be output as character
references.</p>
<p>For example, an attribute with the value "x" followed by "y" separated by a newline will result in the output <code>"x&amp;#xA;y"</code>
(or with any equivalent character reference). The XML output cannot be
"x" followed by a literal newline followed by a "y" because after
parsing, the attribute value would be <code>"x y"</code> as a consequence of the XML attribute normalization rules.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>XML 1.0 did not permit an XML processor to normalize NEL or LINE
SEPARATOR characters to a LINE FEED character. However, if a document
entity that specifies version 1.1 invokes an external general parsed
entity with no text declaration or a text declaration that specifies
version 1.0, the external parsed entity is processed according to the
rules of XML 1.1. For this reason, NEL and LINE SEPARATOR characters in
text and attribute <a title="node" href="#dt-node">nodes</a> must always be escaped using
character references, regardless of the value of the <code>version</code> parameter.</p>
<p>XML 1.0 permitted control characters in the range #x7F through #x9F
to appear as literal characters in an XML document, but XML 1.1
requires such characters, other than NEL, to be escaped as character
references. An external general parsed entity with no text declaration
or a text declaration that specifies a version pseudo-attribute with
value <code>1.0</code> that is invoked by an XML 1.1 document entity <strong>MUST</strong> follow the rules of XML 1.1. Therefore, the non-whitespace control
characters in the ranges #x1 through #x1F and #x7F through #x9F, other than NEL, <strong>MUST</strong> always be escaped, regardless of the value of the version parameter.</p>
</div>
</li>
</ul>
<p>It is a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0004" href="#ERRSE0004">err:SE0004</a>] to specify the doctype-system parameter, or to specify the standalone parameter with a value other than <code>omit</code>, if the instance of the data model contains text <a title="node" href="#dt-node">nodes</a> or multiple element <a title="node" href="#dt-node">nodes</a> as children of the root <a title="node" href="#dt-node">node</a>. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> either signal the error, or recover by ignoring the request to output a document type declaration or <code>standalone</code> parameter.</p>
<p>The result of serialization using the XML output method is not
guaranteed to be well-formed XML if character maps have been specified
(see <a href="#character-maps"><b>9 Character Maps</b></a>).</p>
<div class="div2">
<h3><a id="XML_PARAMS" name="XML_PARAMS"></a>5.1 The Influence of Serialization Parameters upon the XML Output Method</h3>
<div class="div3">
<h4><a id="XML_VERSION" name="XML_VERSION"></a>5.1.1 XML Output Method: the <code>version</code> Parameter</h4>
<p>The <code>version</code> parameter specifies the version of XML and
the version of Namespaces in XML to be used for outputting the instance
of the data model. The version output in the XML declaration (if an XML
declaration is output) <strong>MUST</strong> correspond to the version of XML that the <a title="serializer" href="#serializer">serializer</a> used for outputting the instance of the data model. <span>The value of the <code>version</code> parameter <strong>MUST</strong> match the <a href="http://www.w3.org/TR/REC-xml/#NT-VersionNum">VersionNum</a> <sup><small>XML</small></sup> production of the XML Recommendation <a href="#XML">[XML10]</a>.</span></p>
<p>If the serialized result would contain an <a href="http://www.w3.org/TR/REC-xml-names/#NT-NCName">NCName</a> <sup><small>Names</small></sup> that contains a character that is not permitted by the version of Namespaces in XML specified by the <code>version</code> parameter, a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0005" href="#ERRSE0005">err:SE0005</a>] results. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the
error.</p>
<p>If the serialized result would contain a character that is not permitted by the version of XML specified by the <code>version</code> parameter, a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0006" href="#ERRSE0006">err:SE0006</a>] results. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
<div class="exampleOuter">
<p>For example, if the <code>version</code> parameter has the value <code>1.0</code>, and the instance of the data model contains a non-whitespace control character in the range #x1 to #x1F, a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0006" href="#ERRSE0006">err:SE0006</a>] results. If the <code>version</code> parameter has the value <code>1.1</code> and a comment <a title="node" href="#dt-node">node</a> in the instance of the data model contains a
non-whitespace control character in the range #x1 to #x1F or a control character other than NEL in the range #x7F to #x9F, a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0006" href="#ERRSE0006">err:SE0006</a>] results.</p>
</div>
</div>
<div class="div3">
<h4><a id="XML_ENCODING" name="XML_ENCODING"></a>5.1.2 XML Output Method: the <code>encoding</code> Parameter</h4>
<p>The <code>encoding</code> parameter specifies the encoding to use for outputting the instance of the data model. <a title="serializer" href="#serializer">Serializers</a> are <strong>REQUIRED</strong> to support values of <code>UTF-8</code> and <code>UTF-16</code>. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0007" href="#ERRSE0007">err:SE0007</a>] occurs if an output encoding other than <code>UTF-8</code> or <code>UTF-16</code> is requested and the
<a title="serializer" href="#serializer">serializer</a> does not support that encoding. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error, or recover by using <code>UTF-8</code> or <code>UTF-16</code> instead. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST NOT</strong> use an encoding whose name does not match the <a href="http://www.w3.org/TR/REC-xml/#NT-EncName">EncName</a> <sup><small>XML</small></sup> production of the XML
Recommendation <a href="#XML">[XML10]</a>.</p>
<p>When outputting a newline character in the instance of the data model, the <a title="serializer" href="#serializer">serializer</a>
is free to represent it using any character sequence that will be
normalized to a newline character by an XML parser, unless a specific
mapping for the newline character is provided in a character map: see <a href="#character-maps"><b>9 Character Maps</b></a>.</p>
<p>When outputting any other character that is defined in the selected encoding, the character <strong>MUST</strong> be output using the correct representation of that character in the selected encoding.</p>
<p>It is possible that the instance of the data model will contain a character that cannot be represented in the encoding that the <a title="serializer" href="#serializer">serializer</a>
is using for output. In this case, if the character occurs in a context
where XML recognizes character references (that is, in the value of an
attribute <a title="node" href="#dt-node">node</a> or text <a title="node" href="#dt-node">node</a>), then the character <strong>MUST</strong> be output as a character reference. A
<a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0008" href="#ERRSE0008">err:SE0008</a>]
occurs if such a character appears in a context where character
references are not allowed (for example if the character occurs in the
name of an element). The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
<div class="exampleOuter">
<p>For example, if a text <a title="node" href="#dt-node">node</a> contains the character LATIN SMALL LETTER E WITH ACUTE (#xE9), and the value of the <code>encoding</code> parameter is <code>US-ASCII</code>, the character <strong>MUST</strong> be serialized as a character reference. If a comment <a title="node" href="#dt-node">node</a> contained the same character, a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0008" href="#ERRSE0008">err:SE0008</a>] would
result.</p>
</div>
</div>
<div class="div3">
<h4><a id="xml-indent" name="xml-indent"></a>5.1.3 XML Output Method: the <code>indent</code> Parameter</h4>
<p>If the <code>indent</code> parameter has the value <code>yes</code>, then the XML output method <strong>MAY</strong>
output whitespace in addition to the whitespace in the instance of the
data model in order to indent the result so that a person will find it
easier to read; if the <code>indent</code> parameter has the value <code>no</code>, it <strong>MUST NOT</strong> output any additional whitespace. If the XML output method does output additional whitespace, it <strong>MUST</strong> use an algorithm
to output additional whitespace that satisfies the following constraints:</p>
<ul>
<li>
<p>Whitespace characters <strong>MUST NOT</strong> be added adjacent to a text <a title="node" href="#dt-node">node</a> that contains non-whitespace characters.</p>
</li>
<li>
<p>Whitespace <strong>MAY</strong> only be added adjacent to an element <a title="node" href="#dt-node">node</a>, that is, immediately before a start tag or immediately after an end tag.</p>
</li>
<li>
<p>The new whitespace characters <strong>MAY</strong> replace existing whitespace characters in the same position, for example a tab <strong>MAY</strong> be inserted as a replacement for existing spaces. However, existing whitespace <strong>MUST NOT</strong> be removed without such a replacement.</p>
</li>
<li>
<p>Whitespace characters <strong>MUST NOT</strong> be inserted in a part of the result document that is controlled by an <code>xml:space</code> attribute with value <code>preserve</code>. (See <a href="#XML">[XML10]</a> for more information about the <code>xml:space</code> attribute.)</p>
</li>
<li>
<p>Whitespace characters <strong>SHOULD NOT</strong> be added in places
where the characters would constitute significant whitespace -- for
example,in the content of an element whose content model is known to be
mixed.</p>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The effect of these rules is to ensure that whitespace is only added in places where (a) XSLT's <code>&lt;xsl:strip-space&gt;</code> declaration could cause it to be removed, and (b) it does not affect the <a title="string value" href="#dt-string-value">string value</a> of any element <a title="node" href="#dt-node">node</a> with simple content. It is usually not safe to indent document types that include elements with mixed content.</p>
</div>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The whitespace added may possibly be based on whitespace stripped
from either the source document or the stylesheet (in the case of
XSLT), or guided by other means that might depend on the <a title="host language" href="#host-language">host language</a>, in the case of an instance of the data model created using some other process.</p>
</div>
</div>
<div class="div3">
<h4><a id="XML_CDATA-SECTION-ELEMENTS" name="XML_CDATA-SECTION-ELEMENTS"></a>5.1.4 XML Output Method: the <code>cdata-section-elements</code> Parameter</h4>
<p>The <code>cdata-section-elements</code> parameter contains a list of expanded QNames. If the expanded QName of the parent of a text <a title="node" href="#dt-node">node</a> is a member of the list, then the text <a title="node" href="#dt-node">node</a> <strong>MUST</strong> be output as a CDATA section, except in those circumstances described below.</p>
<p>If the text <a title="node" href="#dt-node">node</a> contains the sequence of characters <code>]]&gt;</code>, then the currently open CDATA section <strong>MUST</strong> be closed following the <code>]]</code> and a new CDATA section opened before the <code>&gt;</code>.</p>
<p>If the text <a title="node" href="#dt-node">node</a> contains
characters that are not representable in the character encoding being
used to output the instance of the data model, then the currently open
CDATA section <strong>MUST</strong> be closed before such characters, the characters <strong>MUST</strong> be output using character references or entity references, and a new CDATA section <strong>MUST</strong> be opened for any further characters in the text <a title="node" href="#dt-node">node</a>.</p>
<p>CDATA sections <strong>MUST NOT</strong> be used except where they have been explicitly requested by the user, either by using the <code>cdata-section-elements</code> parameter, or by using some other <a title="implementation-defined" href="#impdef">implementation-defined</a> mechanism.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This is phrased to permit an implementor to provide an option that
attempts to preserve CDATA sections present in the source document.</p>
</div>
</div>
<div class="div3">
<h4><a id="XML_OMIT-XML-DECLARATION" name="XML_OMIT-XML-DECLARATION"></a>5.1.5 XML Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</h4>
<p>The XML output method <strong>MUST</strong> output an XML declaration if the <code>omit-xml-declaration</code> parameter has the value <code>no</code>. The XML declaration <strong>MUST</strong> include both version information and an encoding declaration. If the <code>standalone</code> parameter has the value <code>yes</code> or the value <code>no</code>, the XML declaration <strong>MUST</strong> include a standalone document declaration with the same value as the value of the <code>standalone</code>
parameter. If the <code>standalone</code> parameter has the value <code>omit</code>, the XML declaration <strong>MUST NOT</strong>
include a standalone document declaration; this ensures that it is both
an XML declaration (allowed at the beginning of a document entity) and
a text declaration (allowed at the beginning of an external general
parsed entity).</p>
<p>A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0009" href="#ERRSE0009">err:SE0009</a>] results if the <code>omit-xml-declaration</code> parameter has the value <code>yes</code>, and</p>
<ul>
<li>
<p>the <code>standalone</code> parameter has a value other than <code>omit</code>; or</p>
</li>
<li>
<p>the <code>version</code> parameter has a value other than <code>1.0</code> and the <code>doctype-system</code> parameter is specified.</p>
</li>
</ul>
The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.
<p>Otherwise, if the <code>omit-xml-declaration</code> parameter has the value <code>yes</code>, the XML output method <strong>MUST NOT</strong> output an XML declaration.</p>
</div>
<div class="div3">
<h4><a id="XML_DOCTYPE" name="XML_DOCTYPE"></a>5.1.6 XML Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</h4>
<p>If the <code>doctype-system</code> parameter is specified, the XML output method <strong>MUST</strong> output a document type declaration immediately before the first element. The name following <code>&lt;!DOCTYPE</code> <strong>MUST</strong> be the name of the first element, if any. If the <code>doctype-public</code> parameter is also specified, then the XML output method <strong>MUST</strong> output <code>PUBLIC</code> followed by the public identifier and then the system identifier; otherwise, it
<strong>MUST</strong> output <code>SYSTEM</code> followed by the system identifier. The internal subset <strong>MUST</strong> be empty. The <code>doctype-public</code> parameter <strong>MUST</strong> be ignored unless the <code>doctype-system</code> parameter is specified.</p>
</div>
<div class="div3">
<h4><a id="xml-undeclare-NS" name="xml-undeclare-NS"></a>5.1.7 XML Output Method: the <code>undeclare-prefixes</code> Parameter</h4>
<p>The Data Model allows an element <a title="node" href="#dt-node">node</a> that binds a non-empty prefix to have a child element <a title="node" href="#dt-node">node</a> that does not bind that same prefix. In Namespaces in XML 1.1 (<a href="#XMLNAMES11">[XML Names 1.1]</a>), this can be represented accurately by undeclaring namespaces. If the <code>undeclare-prefixes</code> parameter has the value <code>yes</code> and the output method is XML and the <code>version</code> is greater than 1.0, the
<a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> undeclare namespaces.</p>
<div class="exampleOuter">
<p>Consider an element <code>x:foo</code> with four in-scope namespaces that associate prefixes with URIs as follows:</p>
<ul>
<li>
<p><code>x</code> is associated with <code>http://example.org/x</code></p>
</li>
<li>
<p><code>y</code> is associated with <code>http://example.org/y</code></p>
</li>
<li>
<p><code>z</code> is associated with <code>http://example.org/z</code></p>
</li>
<li>
<p><code>xml</code> is associated with <code>http://www.w3.org/XML/1998/namespace</code></p>
</li>
</ul>
<p>Suppose that it has a child element <code>x:bar</code> with three in-scope namespaces:</p>
<ul>
<li>
<p><code>x</code> is associated with <code>http://example.org/x</code></p>
</li>
<li>
<p><code>y</code> is associated with <code>http://example.org/y</code></p>
</li>
<li>
<p><code>xml</code> is associated with <code>http://www.w3.org/XML/1998/namespace</code></p>
</li>
</ul>
<p>If namespace undeclaration is in effect, it will be serialized this way:</p>
<div class="exampleInner">
<pre>&lt;x:foo xmlns:x="http://example.org/x"
       xmlns:y="http://example.org/y"
       xmlns:z="http://example.org/z"&gt;
      &lt;x:bar xmlns:z=""&gt;...&lt;/x:bar&gt;
&lt;/x:foo&gt;
</pre></div>
</div>
<p>In Namespaces in XML (<a href="#XMLNAMES">[XML Names]</a>), namespace undeclaration is not possible. If the output method is XML, the value of the <code>undeclare-prefixes</code> parameter is <code>yes</code>, and the value of the <code>version</code> parameter is 1.0, a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0010" href="#ERRSE0010">err:SE0010</a>] results; the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the
error.</p>
</div>
<div class="div3">
<h4><a id="XML_NORMALIZATION-FORM" name="XML_NORMALIZATION-FORM"></a>5.1.8 XML Output Method: the <code>normalization-form</code> Parameter</h4>
<p>The <code>normalization-form</code> parameter is applicable for the XML output method. The values <code>NFC</code> and <code>none</code> <strong>MUST</strong> be supported by the <a title="serializer" href="#serializer">serializer</a>. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0011" href="#ERRSE0011">err:SE0011</a>] results if the value of the <code>normalization-form</code> parameter specifies a normalization form that is not supported by the <a title="serializer" href="#serializer">serializer</a>; the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
<p>It is a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0012" href="#ERRSE0012">err:SE0012</a>] if the value of the parameter is <code>fully-normalized</code> and any relevant construct of the result begins with a combining character. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error. See Section 2.13 of <a href="#XML11">[XML11]</a> for the definition of the relevant constructs of XML.</p>
</div>
<div class="div3">
<h4><a id="XML_MEDIA-TYPE" name="XML_MEDIA-TYPE"></a>5.1.9 XML Output Method: the <code>media-type</code> Parameter</h4>
<p>The <code>media-type</code> parameter is applicable for the XML output method. See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="XML_USE-CHARACTER-MAPS" name="XML_USE-CHARACTER-MAPS"></a>5.1.10 XML Output Method: the <code>use-character-maps</code> Parameter</h4>
<p>The <code>use-character-maps</code> parameter is applicable for the XML output method. See <a href="#character-maps"><b>9 Character Maps</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="XML_BYTE-ORDER-MARK" name="XML_BYTE-ORDER-MARK"></a>5.1.11 XML Output Method: the <code>byte-order-mark</code> Parameter</h4>
<p>The <code>byte-order-mark</code> parameter is applicable for the XML output method. See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="XML_ESCAPE-URI-ATTRIBUTES" name="XML_ESCAPE-URI-ATTRIBUTES"></a>5.1.12 XML Output Method: the <code>escape-uri-attributes</code> Parameter</h4>
<p>The <code>escape-uri-attributes</code> parameter is not applicable for the XML output method. It is the responsibility of the <a title="host language" href="#host-language">host language</a>
to specify whether an error occurs if this parameter is specified in
combination with the XML output method, or if the parameter is simply
dropped.</p>
</div>
<div class="div3">
<h4><a id="XML_INCLUDE-CONTENT-TYPE" name="XML_INCLUDE-CONTENT-TYPE"></a>5.1.13 XML Output Method: the <code>include-content-type</code> Parameter</h4>
<p>The <code>include-content-type</code> parameter is not applicable for the XML output method. It is the responsibility of the <a title="host language" href="#host-language">host language</a>
to specify whether an error occurs if this parameter is specified in
combination with the XML output method, or if the parameter is simply
dropped.</p>
</div>
</div>
</div>
<div class="div1">
<h2><a id="xhtml-output" name="xhtml-output"></a>6 XHTML Output Method</h2>
<p>The XHTML output method serializes the instance of the data model as
XML, using the HTML compatibility guidelines defined in the XHTML
specification.</p>
<p>It is entirely the responsibility of the person or process that
creates the instance of the data model to ensure that the instance of
the data model conforms to the <a href="#XHTML10">[XHTML 1.0]</a> or <a href="#XHTML11">[XHTML 1.1]</a>
specification. It is not an error if the instance of the data model is
invalid XHTML. Equally, it is entirely under the control of the person
or process that creates the instance of the data model whether the
output conforms to XHTML 1.0 Strict, XHTML 1.0 Transitional,
or any other specific definition of XHTML.</p>
<p>The serialization of the instance of the data model follows the same rules as for the XML output method, with the <span>general</span> exceptions noted below <span>and parameter-specific exceptions in <a href="#XHTML_PARAMS"><b>6.1 The Influence of Serialization Parameters upon the XHTML Output Method</b></a></span>. These differences are based on the HTML compatibility guidelines published in Appendix C of <a href="#XHTML10">[XHTML 1.0]</a>, which are designed to ensure that as far as possible, XHTML
is rendered correctly on user agents designed originally to handle HTML.</p>
<ul>
<li>
<p>[<a title="EMPTY" id="XHTMLEMPTY" name="XHTMLEMPTY">Definition</a>: The following XHTML elements have an <b>EMPTY</b> content model: <code>area</code>, <code>base</code>, <code>br</code>, <code>col</code>, <code>hr</code>, <code>img</code>, <code>input</code>, <code>link</code>, <code>meta</code>, <code>basefont</code>, <code>frame</code>, <code>isindex</code>, and <code>param</code>.] Given an empty instance of an XHTML element whose content model is not <a title="EMPTY" href="#XHTMLEMPTY">EMPTY</a>
(for example, an empty title or paragraph) the <a title="serializer" href="#serializer">serializer</a> <strong>MUST NOT</strong> use the minimized form. That is, it <strong>MUST</strong> output <code>&lt;p&gt;&lt;/p&gt;</code> and not <code>&lt;p&nbsp;/&gt;</code>.</p>
</li>
<li>
<p>Given an XHTML element whose content model is <a title="EMPTY" href="#XHTMLEMPTY">EMPTY</a>, the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> use the minimized tag syntax, for example <code>&lt;br&nbsp;/&gt;</code>, as the alternative syntax <code>&lt;br&gt;&lt;/br&gt;</code> allowed by XML gives uncertain results in many existing user agents. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> include a space before the trailing
<code>/&gt;</code>, e.g. <code>&lt;br&nbsp;/&gt;</code>, <code>&lt;hr&nbsp;/&gt;</code> and <code>&lt;img&nbsp;src="karen.jpg"&nbsp; alt="Karen"&nbsp;/&gt;</code>.</p>
</li>
<li>
<p>The <a title="serializer" href="#serializer">serializer</a> <strong>MUST NOT</strong> use the entity reference <code>&amp;apos;</code> which, although legal in XML and therefore in XHTML, is not defined in HTML and is not recognized by all HTML user agents.</p>
</li>
<li>
<p>The <a title="serializer" href="#serializer">serializer</a> <strong>SHOULD</strong>
output namespace declarations in a way that is consistent with the
requirements of the XHTML DTD if this is possible. The XHTML 1.0 DTDs
require the declaration <code>xmlns="http://www.w3.org/1999/xhtml"</code> to appear on the <code>html</code> element, and only on the <code>html</code> element. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> output namespace declarations that are
consistent with the namespace <a title="node" href="#dt-node">nodes</a> present in the <a title="result tree" href="#result-tree">result tree</a>, but it <strong>MUST</strong> avoid outputting redundant namespace declarations on elements where the DTD would make them invalid.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>If the <code>html</code> element is generated by an XSLT literal result element of the form <code>&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt; ... &lt;/html&gt;</code>, or by an XQuery direct element constructor of the same form, then the <code>html</code> element in the result document will have a <a title="node" href="#dt-node">node</a>
name whose prefix is "", which will satisfy the requirements of the
DTD. In other cases the prefix assigned to the element is
implementation-dependent.</p>
</div>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Appendix C of <a href="#XHTML10">[XHTML 1.0]</a> describes a number
of compatibility guidelines for users of XHTML who wish to render their
XHTML documents with HTML user agents. In some cases, such as the
guideline on the form empty elements should take, only the
serialization process itself has the ability to follow the guideline.
In such cases, those guidelines are reflected in the requirements on
the <a title="serializer" href="#serializer">serializer</a> described above.</p>
<p>In all other cases, the guidelines can be adhered to by the instance
of the data model that is input to the serialization process. The
guideline on the use of whitespace characters in attribute values is
one such example. Another example is that <code>xml:lang="..."</code> does not serialize to both <code>xml:lang="..."</code> and <code>lang="..."</code>
as required by some legacy user agents. It is the responsibility of the
person or process that creates the instance of the data model that is
input to
the serialization process to ensure it is created in a way that is
consistent with the guidelines. No <a title="serialization error" href="#serial-err">serialization error</a> results if the input instance of the data model does not adhere to the guidelines.</p>
</div>
<div class="div2">
<h3><a id="XHTML_PARAMS" name="XHTML_PARAMS"></a>6.1 The Influence of Serialization Parameters upon the XHTML Output Method</h3>
<div class="div3">
<h4><a id="XHTML_VERSION" name="XHTML_VERSION"></a>6.1.1 XHTML Output Method: the <code>version</code> Parameter</h4>
<p>The behavior for <code>version</code> parameter for the XHTML output method is described in <a href="#XML_VERSION"><b>5.1.1 XML Output Method: the version Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_ENCODING" name="XHTML_ENCODING"></a>6.1.2 XHTML Output Method: the <code>encoding</code> Parameter</h4>
<p>The behavior for <code>encoding</code> parameter for the XHTML output method is described in <a href="#XML_ENCODING"><b>5.1.2 XML Output Method: the encoding Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_INDENT" name="XHTML_INDENT"></a>6.1.3 XHTML Output Method: the <code>indent</code> Parameter</h4>
<p>If the <code>indent</code> parameter has the value <code>yes</code>, the serializer may add or remove whitespace as it serializes the <a title="result tree" href="#result-tree">result tree</a>, so long as it does not change the way that a conforming HTML user agent would render the output.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This rule can be satisfied by observing the following constraints:</p>
<ul>
<li>
<p>Whitespace must only be added before or after an element, or adjacent to an existing whitespace character.</p>
</li>
<li>
<p>Whitespace must not be added or removed adjacent to an inline
element. The inline elements are those elements in the XHTML namespace
in the %inline category of any of the XHTML 1.0 DTD's, in the
%inline.class category of the XHTML 1.1 DTD, and elements in the XHTML
namespace with local names <code>ins</code> and <code>del</code> if they are used as inline elements (i.e., if they do not contain element children).</p>
</li>
<li>
<p>Whitespace must not be added or removed inside a formatted element,
the formatted elements being those in the XHTML namespace with local
names <code>pre</code>, <code>script</code>, <code>style</code>, and <code>textarea</code>.</p>
</li>
</ul>
<p>The HTML definition of whitespace is different from the XML definition: see section 9.1 of <a href="#HTML">[HTML]</a> 4.01 specification.</p>
</div>
</div>
<div class="div3">
<h4><a id="XHTML_CDATA-SECTION-ELEMENTS" name="XHTML_CDATA-SECTION-ELEMENTS"></a>6.1.4 XHTML Output Method: the <code>cdata-section-elements</code> Parameter</h4>
<p>The behavior for <code>cdata-section-elements</code> parameter for the XHTML output method is described in <a href="#XML_CDATA-SECTION-ELEMENTS"><b>5.1.4 XML Output Method: the cdata-section-elements Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_OMIT-XML-DECLARATION" name="XHTML_OMIT-XML-DECLARATION"></a>6.1.5 XHTML Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</h4>
<p>The behavior for <code>omit-xml-declaration</code> and <code>standalone</code> parameters for the XHTML output method is described in <a href="#XML_OMIT-XML-DECLARATION"><b>5.1.5 XML Output Method: the omit-xml-declaration and standalone Parameters</b></a>.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>As with the XML output method, the XHTML output method specifies
that an XML declaration will be output unless it is suppressed using
the <code>omit-xml-declaration</code> parameter. Appendix C.1 of <a href="#XHTML10">[XHTML 1.0]</a> provides advice on the consequences of including, or omitting, the XML declaration.</p>
</div>
</div>
<div class="div3">
<h4><a id="XHTML_DOCTYPE" name="XHTML_DOCTYPE"></a>6.1.6 XHTML Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</h4>
<p>The behavior for <code>doctype-system</code> and <code>doctype-public</code> parameters for the XHTML output method is described in <a href="#XML_DOCTYPE"><b>5.1.6 XML Output Method: the doctype-system and doctype-public Parameters</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_UNDECLARE-PREFIXES" name="XHTML_UNDECLARE-PREFIXES"></a>6.1.7 XHTML Output Method: the <code>undeclare-prefixes</code> Parameter</h4>
<p>The behavior for <code>undeclare-prefixes</code> parameter for the XHTML output method is described in <a href="#xml-undeclare-NS"><b>5.1.7 XML Output Method: the undeclare-prefixes Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_NORMALIZATION-FORM" name="XHTML_NORMALIZATION-FORM"></a>6.1.8 XHTML Output Method: the <code>normalization-form</code> Parameter</h4>
<p>The behavior for <code>normalization-form</code> parameter for the XHTML output method is described in <a href="#XML_NORMALIZATION-FORM"><b>5.1.8 XML Output Method: the normalization-form Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_MEDIA-TYPE" name="XHTML_MEDIA-TYPE"></a>6.1.9 XHTML Output Method: the <code>media-type</code> Parameter</h4>
<p>The behavior for <code>media-type</code> parameter for the XHTML output method is described in <a href="#XML_MEDIA-TYPE"><b>5.1.9 XML Output Method: the media-type Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_USE-CHARACTER-MAPS" name="XHTML_USE-CHARACTER-MAPS"></a>6.1.10 XHTML Output Method: the <code>use-character-maps</code> Parameter</h4>
<p>The behavior for <code>use-character-maps</code> parameter for the XHTML output method is described in <a href="#XML_USE-CHARACTER-MAPS"><b>5.1.10 XML Output Method: the use-character-maps Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_BYTE-ORDER-MARK" name="XHTML_BYTE-ORDER-MARK"></a>6.1.11 XHTML Output Method: the <code>byte-order-mark</code> Parameter</h4>
<p>The behavior for <code>byte-order-mark</code> parameter for the XHTML output method is described in <a href="#XML_BYTE-ORDER-MARK"><b>5.1.11 XML Output Method: the byte-order-mark Parameter</b></a>.</p>
</div>
<div class="div3">
<h4><a id="XHTML_ESCAPE-URI-ATTRIBUTES" name="XHTML_ESCAPE-URI-ATTRIBUTES"></a>6.1.12 XHTML Output Method: the <code>escape-uri-attributes</code> Parameter</h4>
<p>If the <code>escape-uri-attributes</code> parameter has the value <code>yes</code>, the XHTML output method <strong>MUST</strong> apply <a title="URI Escaping" href="#uri-escaping">URI escaping</a> to URI attribute values, except that relative URIs <strong>MUST NOT</strong> be absolutized.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This escaping is deliberately confined to non-ASCII characters,
because escaping of ASCII characters is not always appropriate, for
example when URIs or URI fragments are interpreted locally by the HTML
user agent. Even in the case of non-ASCII characters, escaping can
sometimes cause problems. More precise control of <a title="URI Escaping" href="#uri-escaping">URI escaping</a> is therefore available by setting <code>escape-uri-attributes</code> to <code>no</code>, and controlling the escaping of URIs
by means of the <code>fn:escape-uri</code> function defined in <a href="#xpath-functions">[XQuery 1.0 and XPath 2.0 Functions and Operators]</a>.</p>
</div>
</div>
<div class="div3">
<h4><a id="XHTML_INCLUDE-CONTENT-TYPE" name="XHTML_INCLUDE-CONTENT-TYPE"></a>6.1.13 XHTML Output Method: the <code>include-content-type</code> Parameter</h4>
<p>If the instance of the data model includes a <code>head</code> element in the XHTML namespace, and the <code>include-content-type</code> parameter has the value <code>yes</code>, the XHTML output method <strong>MUST</strong> add a <code>meta</code> element as the first child element of the <code>head</code> element, specifying the character encoding actually used.</p>
<div class="exampleOuter">
<p>For example,</p>
<div class="exampleInner">
<pre>&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=EUC-JP" /&gt;
...
</pre></div>
</div>
<p>The content type <strong>SHOULD</strong> be set to the value given for the <code>media-type</code> parameter.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>It is recommended that the host language use as default value for this parameter one of the MIME types (<a href="#RFC2046">[RFC2046]</a>) registered for XHTML. Currently, these are <code>text/html</code> (registered by <a href="#RFC2854">[RFC2854]</a>) and <code>application/xhtml-xml</code> (registered by <a href="#RFC3236">[RFC3236]</a>). Note that some user agents fail to recognize the charset parameter if the content type is not <code>text/html</code>.</p>
</div>
<p>If a <code>meta</code> element has been added to the <code>head</code> element as described above, then any existing <code>meta</code> element child of the <code>head</code> element having an <code>http-equiv</code> attribute with the value "Content-Type", making the comparison without consideration of casing and leading/trailing spaces, <strong>MUST</strong> be discarded.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This process removes possible parameters in the attribute value. For example,</p>
<div class="exampleInner">
<pre>&lt;meta http-equiv="Content-Type"
        content="text/html;version='3.0'" /&gt;
</pre></div>
<p>in the data model instance would be replaced by,</p>
<div class="exampleInner">
<pre>&lt;meta http-equiv="Content-Type"
        content="text/html;charset=utf-8" /&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="div1">
<h2><a id="html-output" name="html-output"></a>7 HTML Output Method</h2>
<p>The HTML output method serializes the instance of the data model as HTML.</p>
<div class="exampleOuter">
<p>For example, the following XSL stylesheet generates html output,</p>
<div class="exampleInner">
<pre>&lt;xsl:stylesheet version="2.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

&lt;xsl:output method="html" version=&#8221;4.0&#8221;/&gt;

&lt;xsl:template match="/"&gt;
&lt;html&gt;
&lt;xsl:apply-templates/&gt;
&lt;/html&gt;
&lt;/xsl:template&gt;

...

&lt;/xsl:stylesheet&gt;
</pre></div>
</div>
<p>In the example, the <code>version</code> attribute of the <code>xsl:output</code> element indicates the version of the HTML Recommendation <a href="#HTML">[HTML]</a> to which the serialized result is to conform.</p>
<div class="div2">
<h3><a id="N10E9A" name="N10E9A"></a>7.1 Markup for Elements</h3>
<p>The HTML output method <strong>MUST NOT</strong> output an element differently from the XML output method unless the expanded QName of the element has a <a title="null namespace URI" href="#null-namespace-URI">null namespace URI</a>. [<a title="XML Island" id="XML-ISLAND" name="XML-ISLAND">Definition</a>: An element whose expanded QName has a <a title="non-null namespace URI" href="#non-null-namespace-URI">non-null namespace URI</a> <strong>MUST</strong> be output as XML. This is known as an <b>XML
Island</b>.] If the expanded QName of the element has a <a title="null namespace URI" href="#null-namespace-URI">null namespace URI</a>, but the local part of the expanded QName is not recognized as the name of an HTML element, the element <strong>MUST</strong> be output in the same way as a non-empty, inline element such as <code>span</code>. In particular:</p>
<ol class="enumar">
<li>
<p>If the <a title="result tree" href="#result-tree">result tree</a> contains namespace <a title="node" href="#dt-node">nodes</a> for namespaces other than the XML namespace, the HTML output method <strong>MUST</strong> represent these namespaces using attributes named <code>xmlns</code> or <code>xmlns:</code><em>prefix</em> in the same way as the XML output method would represent them when the version parameter is set to 1.0.</p>
</li>
<li>
<p>If the <a title="result tree" href="#result-tree">result tree</a> contains elements or attributes whose names have a <a title="non-null namespace URI" href="#non-null-namespace-URI">non-null namespace URI</a>, the HTML output method <strong>MUST</strong> generate namespace-prefixed QNames for these <a title="node" href="#dt-node">nodes</a> in the same way as the XML output method would do when the version parameter is set to 1.0.</p>
</li>
<li>
<p>Where special rules are defined later in this section for serializing specific HTML elements and attributes, these rules <strong>MUST NOT</strong> be applied to an element or attribute whose name has a <a title="non-null namespace URI" href="#non-null-namespace-URI">non-null namespace URI</a>.
However, the generic rules for the HTML output method that apply to all
elements and attributes, for example the rules for escaping special
characters in the text and the rules for indentation,
<strong>MUST</strong> be used also for namespaced elements and attributes.</p>
</li>
<li>
<p>When serializing an element whose name is not defined in the HTML
specification, but that is in the null namespace, the HTML output
method <strong>MUST</strong> apply the same rules (for example, indentation rules) as when serializing a <code>span</code> element. The descendants of such an element <strong>MUST</strong> be serialized as if they were descendants of a <code>span</code> element.</p>
</li>
<li>
<p>When serializing an element whose name is in a non-null namespace, the HTML output method <strong>MUST</strong> apply the same rules (for example, indentation rules) as when serializing a <code>div</code> element. The descendants of such an element <strong>MUST</strong> be serialized as if they were descendants of a <code>div</code> element.</p>
</li>
</ol>
<p>The HTML output method <strong>MUST NOT</strong> output an end-tag for empty elements. For HTML 4.0, the empty elements are <code>area</code>, <code>base</code>, <code>basefont</code>, <code>br</code>, <code>col</code>, <code>frame</code>, <code>hr</code>, <code>img</code>, <code>input</code>, <code>isindex</code>, <code>link</code>, <code>meta</code> and <code>param</code>. For example, an element written as <code>&lt;br/&gt;</code> or <code>&lt;br&gt;&lt;/br&gt;</code> in an XSLT stylesheet
<strong>MUST</strong> be output as <code>&lt;br&gt;</code>.</p>
<p>The HTML output method <strong>MUST</strong> recognize the names of HTML elements regardless of case. For example, elements named <code>br</code>, <code>BR</code> or <code>Br</code> <strong>MUST</strong> all be recognized as the HTML <code>br</code> element and output without an end-tag.</p>
<p>The HTML output method <strong>MUST NOT</strong> perform escaping for the content of the <code>script</code> and <code>style</code> elements.</p>
<div class="exampleOuter">
<p>For example, a <code>script</code> element created by an XQuery direct element constructor or an XSLT literal result element, such as:</p>
<div class="exampleInner">
<pre>&lt;script&gt;if (a &amp;lt; b) foo()&lt;/script&gt;
</pre></div>
<p>or</p>
<div class="exampleInner">
<pre>&lt;script&gt;&lt;![CDATA[if (a &lt; b) foo()]]&gt;&lt;/script&gt;
</pre></div>
<p><strong>MUST</strong> be output as</p>
<div class="exampleInner">
<pre>&lt;script&gt;if (a &lt; b) foo()&lt;/script&gt;
</pre></div>
</div>
<div class="exampleOuter">
<p>A common requirement is to output a <code>script</code> element as shown in the example below:</p>
<div class="exampleInner">
<pre>&lt;script type="text/javascript"&gt;
      document.write ("&lt;em&gt;This won't work&lt;/em&gt;")
&lt;/script&gt;
</pre></div>
<p>This is illegal HTML, for the reasons explained in section B.3.2 of
the HTML 4.01 specification. Nevertheless, it is possible to output
this fragment, using either of the following constructs:</p>
<p>Firstly, by use of a <code>script</code> element created by an XQuery direct element constructor or an XSLT literal result element:</p>
<div class="exampleInner">
<pre>&lt;script type="text/javascript"&gt;
      document.write ("&lt;em&gt;This won't work&lt;/em&gt;")
&lt;/script&gt;
</pre></div>
<p>Secondly, by constructing the markup from ordinary text characters:</p>
<div class="exampleInner">
<pre>&lt;script type="text/javascript"&gt;
      document.write ("&amp;lt;em&amp;gt;This won't work&amp;lt;/em&amp;gt;")
&lt;/script&gt;
</pre></div>
<p>As the HTML specification points out, the correct way to write this
is to use the escape conventions for the specific scripting language.
For JavaScript, it can be written as:</p>
<div class="exampleInner">
<pre>&lt;script type="text/javascript"&gt;
      document.write ("&amp;lt;em&amp;gt;This will work&amp;lt;\/em&amp;gt;")
&lt;/script&gt;
</pre></div>
<p>The HTML 4.01 specification also shows examples of how to write this in various other scripting languages. The escaping <strong>MUST</strong> be done manually, it will not be done by the <a title="serializer" href="#serializer">serializer</a>.</p>
</div>
</div>
<div class="div2">
<h3><a id="N10FA6" name="N10FA6"></a>7.2 Writing Attributes</h3>
<p>The HTML output method <strong>MUST NOT</strong> escape "<code>&lt;</code>" characters occurring in attribute values.</p>
<p>The HTML output method <strong>MUST</strong> output boolean
attributes (that is attributes with only a single allowed value that is
equal to the name of the attribute) in minimized form.</p>
<div class="exampleOuter">
<p>For example, a start-tag created using the following XQuery direct element constructor or XSLT literal result element</p>
<div class="exampleInner">
<pre>&lt;OPTION selected="selected"&gt;
</pre></div>
<p><strong>MUST</strong> be output as</p>
<div class="exampleInner">
<pre>&lt;OPTION selected&gt;
</pre></div>
</div>
<p>The HTML output method <strong>MUST NOT</strong> escape a <code>&amp;</code> character occurring in an attribute value immediately followed by a <code>{</code> character (see <a href="http://www.w3.org/TR/REC-html40/appendix/notes.html#h-B.7.1.1">Section B.7.1</a> of the HTML 4.0 Recommendation).</p>
<div class="exampleOuter">
<p>For example, a start-tag created using the following XQuery direct element constructor or XSLT literal result element</p>
<div class="exampleInner">
<pre>&lt;BODY bgcolor='&amp;{{randomrbg}};'&gt;
</pre></div>
<p><strong>MUST</strong> be output as</p>
<div class="exampleInner">
<pre>&lt;BODY bgcolor='&amp;{randomrbg};'&gt;
</pre></div>
</div>
<p>See <a href="#HTML_PARAMS"><b>7.4 The Influence of Serialization Parameters upon the HTML Output Method</b></a> for additional directives on how attributes may be written.</p>
</div>
<div class="div2">
<h3><a id="N10FE9" name="N10FE9"></a>7.3 Writing Character Data</h3>
<p>The HTML output method <strong>MAY</strong> output a character using
a character entity reference in preference to using a numeric character
reference, if an entity is defined for the character in the version of
HTML that the output method is using. Entity references and character
references <strong>SHOULD</strong> be used only where the character is
not present in the selected encoding, or where the visual
representation of the character is unclear (as with <code>&amp;nbsp;</code>, for example).</p>
<p>When outputting a sequence of whitespace characters in the instance
of the data model, within an element where whitespace is treated
normally (but not in elements such as <code>pre</code> and <code>textarea</code>), the HTML output method <strong>MAY</strong> represent it using any sequence of whitespace that will be treated in the same way by an HTML user agent. See section 3.5 of <a href="#xhtml-mod">[XHTML Modularization]</a> for some additional information on handling of whitespace by an HTML user
agent.</p>
<p>Certain characters, specifically the control characters #x7F-#x9F, are legal in XML but not in HTML. It is a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0014" href="#ERRSE0014">err:SE0014</a>] to use the HTML output method when such characters appear in the instance of the data model. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
<p>The HTML output method <strong>MUST</strong> terminate processing instructions with <code>&gt;</code> rather than <code>?&gt;</code>. It is a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0015" href="#ERRSE0015">err:SE0015</a>] to use the HTML output method when <code>&gt;</code> appears within a processing instruction in the data model instance being serialized.</p>
</div>
<div class="div2">
<h3><a id="HTML_PARAMS" name="HTML_PARAMS"></a>7.4 The Influence of Serialization Parameters upon the HTML Output Method</h3>
<div class="div3">
<h4><a id="HTML_VERSION" name="HTML_VERSION"></a>7.4.1 HTML Output Method: the <code>version</code> Parameter</h4>
<p>The <code>version</code> attribute indicates the version of the HTML Recommendation <a href="#HTML">[HTML]</a> to which the serialized result is to conform. If the <a title="serializer" href="#serializer">serializer</a> does not support the version of HTML specified by this parameter, it <strong>MUST</strong> signal a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0013" href="#ERRSE0013">err:SE0013</a>].</p>
</div>
<div class="div3">
<h4><a id="HTML_ENCODING" name="HTML_ENCODING"></a>7.4.2 HTML Output Method: the <code>encoding</code> Parameter</h4>
<p>The <code>encoding</code> parameter specifies the encoding to be used. <a title="serializer" href="#serializer">Serializers</a> are <strong>REQUIRED</strong> to support values of <code>UTF-8</code> and <code>UTF-16</code>. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0007" href="#ERRSE0007">err:SE0007</a>] occurs if an output encoding other than <code>UTF-8</code> or <code>UTF-16</code> is requested and the <a title="serializer" href="#serializer">serializer</a> does not support that encoding. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
<p>It is possible that the instance of the data model will contain a character that cannot be represented in the encoding that the <a title="serializer" href="#serializer">serializer</a>
is using for output. In this case, if the character occurs in a context
where HTML recognizes character references, then the character <strong>MUST</strong> be output as a character entity reference or decimal numeric character reference; otherwise (for example, in a <code>script</code> or <code>style</code> element or in
a comment), the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0008" href="#ERRSE0008">err:SE0008</a>].</p>
<p>See <a href="#HTML_INCLUDE-CONTENT-TYPE"><b>7.4.13 HTML Output Method: the include-content-type Parameter</b></a> regarding how this parameter is used with the <code>include-content-type</code> parameter.</p>
</div>
<div class="div3">
<h4><a id="HTML_INDENT" name="HTML_INDENT"></a>7.4.3 HTML Output Method: the <code>indent</code> Parameter</h4>
<p>If the <code>indent</code> parameter has the value <code>yes</code>, then the HTML output method <strong>MAY</strong> add or remove whitespace as it serializes the <a title="result tree" href="#result-tree">result tree</a>, so long as it does not change the way that a conforming HTML user agent would render the output.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This rule can be satisfied by observing the following constraints:</p>
<p>Whitespace <strong>MUST</strong> only be added before or after an element, or adjacent to an existing whitespace character.</p>
<p>Whitespace <strong>MUST NOT</strong> be added or removed adjacent to an inline element. The inline elements are those included in the <code>%inline</code> category of any of the HTML 4.01 DTD's, as well as the <code>ins</code> and <code>del</code> elements if they are used as inline elements (i.e., if they do not contain element children).</p>
<p>Whitespace <strong>MUST NOT</strong> be added or removed inside a formatted element, the formatted elements being <code>pre</code>, <code>script</code>, <code>style</code>, and <code>textarea</code>.</p>
<p>Note that the HTML definition of whitespace is different from the XML definition: see section 9.1 of the <a href="#HTML">[HTML]</a> specification.</p>
</div>
</div>
<div class="div3">
<h4><a id="HTML_CDATA-SECTION-ELEMENTS" name="HTML_CDATA-SECTION-ELEMENTS"></a>7.4.4 HTML Output Method: the <code>cdata-section-elements</code> Parameter</h4>
<p>The <code>cdata-section-elements</code> is not applicable to HTML output, except in the case of <a title="XML Island" href="#XML-ISLAND">XML Islands</a>.</p>
</div>
<div class="div3">
<h4><a id="HTML_OMIT-XML-DECLARATION" name="HTML_OMIT-XML-DECLARATION"></a>7.4.5 HTML Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</h4>
<p>The <code>omit-xml-declaration</code> and <code>standalone</code> parameters are not applicable to the HTML output method.</p>
</div>
<div class="div3">
<h4><a id="HTML_DOCTYPE" name="HTML_DOCTYPE"></a>7.4.6 HTML Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</h4>
<p>If the <code>doctype-public</code> or <code>doctype-system</code> parameters are specified, then the HTML output method <strong>MUST</strong> output a document type declaration immediately before the first element. The name following <code>&lt;!DOCTYPE</code> <strong>MUST</strong> be <code>HTML</code> or <code>html</code>. If the <code>doctype-public</code> parameter is specified, then the output method <strong>MUST</strong> output <code>PUBLIC</code> followed by the specified public identifier; if the
<code>doctype-system</code> parameter is also specified, it <strong>MUST</strong> also output the specified system identifier following the public identifier. If the <code>doctype-system</code> parameter is specified but the <code>doctype-public</code> parameter is not specified, then the output method <strong>MUST</strong> output <code>SYSTEM</code> followed by the specified system identifier.</p>
</div>
<div class="div3">
<h4><a id="HTML_UNDECLARE-PREFIXES" name="HTML_UNDECLARE-PREFIXES"></a>7.4.7 HTML Output Method: the <code>undeclare-prefixes</code> Parameter</h4>
<p>The <code>undeclare-prefixes</code> is not applicable to HTML output, except in the case of <a title="XML Island" href="#XML-ISLAND">XML Islands</a>.</p>
</div>
<div class="div3">
<h4><a id="HTML_NORMALIZATION-FORM" name="HTML_NORMALIZATION-FORM"></a>7.4.8 HTML Output Method: the <code>normalization-form</code> Parameter</h4>
<p>The <code>normalization-form</code> parameter is applicable for the HTML output method. The values <code>NFC</code> and <code>none</code> <strong>MUST</strong> be supported by the <a title="serializer" href="#serializer">serializer</a>. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0011" href="#ERRSE0011">err:SE0011</a>] results if the value of the <code>normalization-form</code> parameter specifies a normalization form that is not supported by the
<a title="serializer" href="#serializer">serializer</a>; the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
</div>
<div class="div3">
<h4><a id="HTML_MEDIA-TYPE" name="HTML_MEDIA-TYPE"></a>7.4.9 HTML Output Method: the <code>media-type</code> Parameter</h4>
<p>The <code>media-type</code> parameter is applicable for the HTML output method. See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more information. See <a href="#HTML_INCLUDE-CONTENT-TYPE"><b>7.4.13 HTML Output Method: the include-content-type Parameter</b></a> regarding how this parameter is used with the <code>include-content-type</code> parameter.</p>
</div>
<div class="div3">
<h4><a id="HTML_USE-CHARACTER-MAPS" name="HTML_USE-CHARACTER-MAPS"></a>7.4.10 HTML Output Method: the <code>use-character-maps</code> Parameter</h4>
<p>The <code>use-character-maps</code> parameter is applicable for the HTML output method. See <a href="#character-maps"><b>9 Character Maps</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="HTML_BYTE-ORDER-MARK" name="HTML_BYTE-ORDER-MARK"></a>7.4.11 HTML Output Method: the <code>byte-order-mark</code> Parameter</h4>
<p>The <code>byte-order-mark</code> parameter is applicable for the HTML output method. See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="HTML_ESCAPE-URI-ATTRIBUTES" name="HTML_ESCAPE-URI-ATTRIBUTES"></a>7.4.12 HTML Output Method: the <code>escape-uri-attributes</code> Parameter</h4>
<p>If the <code>escape-uri-attributes</code> parameter has the value <code>yes</code>, the HTML output method <strong>MUST</strong> apply <a title="URI Escaping" href="#uri-escaping">URI escaping</a> to URI attribute values, except that relative URIs <strong>MUST NOT</strong> be absolutized.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This escaping is deliberately confined to non-ASCII characters,
because escaping of ASCII characters is not always appropriate, for
example when URIs or URI fragments are interpreted locally by the HTML
user agent. Even in the case of non-ASCII characters, escaping can
sometimes cause problems. More precise control of <a title="URI Escaping" href="#uri-escaping">URI escaping</a> is therefore available by setting <code>escape-uri-attributes</code> to <code>no</code>, and controlling the escaping of URIs
by means of the <code>fn:escape-uri</code> function defined in <a href="#xpath-functions">[XQuery 1.0 and XPath 2.0 Functions and Operators]</a>.</p>
</div>
</div>
<div class="div3">
<h4><a id="HTML_INCLUDE-CONTENT-TYPE" name="HTML_INCLUDE-CONTENT-TYPE"></a>7.4.13 HTML Output Method: the <code>include-content-type</code> Parameter</h4>
<p>If there is a <code>head</code> element, and the <code>include-content-type</code> parameter has the value <code>yes</code>, the HTML output method <strong>MUST</strong> add a <code>meta</code> element as the first child element of the <code>head</code> element specifying the character encoding actually used.</p>
<div class="exampleOuter">
<p>For example,</p>
<div class="exampleInner">
<pre>&lt;HEAD&gt;
&lt;META http-equiv="Content-Type" content="text/html; charset=EUC-JP"&gt;
...
</pre></div>
</div>
<p>The content type <strong>MUST</strong> be set to the value given for the <code>media-type</code> parameter.</p>
<p>If a <code>meta</code> element has been added to the <code>head</code> element as described above, then any existing <code>meta</code> element child of the <code>head</code> element having an <code>http-equiv</code> attribute with the value "Content-Type" <strong>MUST</strong> be discarded.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This process removes possible parameters in the attribute value. For example,</p>
<div class="exampleInner">
<pre>&lt;meta http-equiv="Content-Type"
        content="text/html;version='3.0'"/&gt;
</pre></div>
<p>in the data model instance would be replaced by,</p>
<div class="exampleInner">
<pre>&lt;meta http-equiv="Content-Type"
        content="text/html;charset=utf-8"/&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="div1">
<h2><a id="text-output" name="text-output"></a>8 Text Output Method</h2>
<p>The text output method serializes the instance of the data model by outputting the <a title="string value" href="#dt-string-value">string value</a> of the document <a title="node" href="#dt-node">node</a> created by <a title="sequence normalization" href="#sequence-normalization">sequence normalization</a>, without any escaping.</p>
<p>A newline character in the instance of the data model <strong>MAY</strong> be output using any character sequence that is conventionally used to represent a line ending in the chosen system environment.</p>
<div class="div2">
<h3><a id="TEXT_PARAMS" name="TEXT_PARAMS"></a>8.1 The Influence of Serialization Parameters upon the Text Output Method</h3>
<div class="div3">
<h4><a id="TEXT_VERSION" name="TEXT_VERSION"></a>8.1.1 Text Output Method: the <code>version</code> Parameter</h4>
<p>The <code>version</code> parameter is not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_ENCODING" name="TEXT_ENCODING"></a>8.1.2 Text Output Method: the <code>encoding</code> Parameter</h4>
<p>The <code>encoding</code> parameter identifies the encoding that the text output method <strong>MUST</strong> use to convert sequences of characters to sequences of bytes. <a title="serializer" href="#serializer">Serializers</a> are <strong>REQUIRED</strong> to support values of <code>UTF-8</code> and <code>UTF-16</code>. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0007" href="#ERRSE0007">err:SE0007</a>] occurs if the <a title="serializer" href="#serializer">serializer</a> does not support the encoding specified by the <code>encoding</code> parameter. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error. If the instance of the data model contains a character that cannot be represented in the encoding that the <a title="serializer" href="#serializer">serializer</a> is using for output, the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal a <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0008" href="#ERRSE0008">err:SE0008</a>].</p>
</div>
<div class="div3">
<h4><a id="TEXT_INDENT" name="TEXT_INDENT"></a>8.1.3 Text Output Method: the <code>indent</code> Parameter</h4>
<p>The <code>indent</code> parameter is not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_CDATA-SECTION-ELEMENTS" name="TEXT_CDATA-SECTION-ELEMENTS"></a>8.1.4 Text Output Method: the <code>cdata-section-elements</code> Parameter</h4>
<p>The <code>cdata-section-elements</code> parameter is not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_OMIT-XML-DECLARATION" name="TEXT_OMIT-XML-DECLARATION"></a>8.1.5 Text Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</h4>
<p>The <code>omit-xml-declaration</code> and <code>standalone</code> parameters are not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_DOCTYPE" name="TEXT_DOCTYPE"></a>8.1.6 Text Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</h4>
<p>The <code>doctype-system</code> and <code>doctype-public</code> parameters are not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_UNDECLARE-PREFIXES" name="TEXT_UNDECLARE-PREFIXES"></a>8.1.7 Text Output Method: the <code>undeclare-prefixes</code> Parameter</h4>
<p>The <code>undeclare-prefixes</code> parameter is not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_NORMALIZATION-FORM" name="TEXT_NORMALIZATION-FORM"></a>8.1.8 Text Output Method: the <code>normalization-form</code> Parameter</h4>
<p>The <code>normalization-form</code> parameter is applicable for the text output method. The values <code>NFC</code> and <code>none</code> <strong>MUST</strong> be supported by the <a title="serializer" href="#serializer">serializer</a>. A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0011" href="#ERRSE0011">err:SE0011</a>] results if the value of the <code>normalization-form</code> parameter specifies a normalization form that is not supported by the
<a title="serializer" href="#serializer">serializer</a>; the <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
</div>
<div class="div3">
<h4><a id="TEXT_MEDIA-TYPE" name="TEXT_MEDIA-TYPE"></a>8.1.9 Text Output Method: the <code>media-type</code> Parameter</h4>
<p>The <code>media-type</code> parameter is applicable for the text output method. See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="TEXT_USE-CHARACTER-MAPS" name="TEXT_USE-CHARACTER-MAPS"></a>8.1.10 Text Output Method: the <code>use-character-maps</code> Parameter</h4>
<p>The <code>use-character-maps</code> parameter is applicable for the text output method. See <a href="#character-maps"><b>9 Character Maps</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="TEXT_BYTE-ORDER-MARK" name="TEXT_BYTE-ORDER-MARK"></a>8.1.11 Text Output Method: the <code>byte-order-mark</code> Parameter</h4>
<p>The <code>byte-order-mark</code> parameter is applicable for the text output method. See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
</div>
<div class="div3">
<h4><a id="TEXT_ESCAPE-URI-ATTRIBUTES" name="TEXT_ESCAPE-URI-ATTRIBUTES"></a>8.1.12 Text Output Method: the <code>escape-uri-attributes</code> Parameter</h4>
<p>The <code>escape-uri-attributes</code> parameter is not applicable to the Text output method.</p>
</div>
<div class="div3">
<h4><a id="TEXT_INCLUDE-CONTENT-TYPE" name="TEXT_INCLUDE-CONTENT-TYPE"></a>8.1.13 Text Output Method: the <code>include-content-type</code> Parameter</h4>
<p>The <code>escape-uri-attributes</code> parameter is not applicable to the Text output method.</p>
</div>
</div>
</div>
<div class="div1">
<h2><a id="character-maps" name="character-maps"></a>9 Character Maps</h2>
<p>The <code>use-character-maps</code> parameter is a list of characters and corresponding string substitutions.</p>
<p>Character maps allow a specific character appearing in a text or attribute <a title="node" href="#dt-node">node</a>
in the instance of the data model to be replaced with a specified
string of characters during serialization. The string that is
substituted is output "as is," and the <a title="serializer" href="#serializer">serializer</a>
performs no checks that the resulting document is well-formed. This
mechanism can therefore be used to introduce arbitrary markup in the
serialized output. See <a href="http://www.w3.org/TR/xslt20/#character-maps">Section 20.1 Character Maps</a><sup><small>XT</small></sup> of <a href="#xslt20">[XSL Transformations (XSLT) Version 2.0]</a> for examples of using character mapping in XSLT.</p>
<p>Character mapping is applied to the characters that actually appear in a text or attribute <a title="node" href="#dt-node">node</a> in the instance of the data model, before any other serialization operations such as escaping or <a title="Unicode Normalization" href="#unicode-normalization">Unicode Normalization</a>
are applied. If a character is mapped, then it is not subjected to XML
or HTML escaping, nor to Unicode Normalization. The string that is
substituted for a character is not validated or
processed in any way by the <a title="serializer" href="#serializer">serializer</a>,
except for translation into the target encoding. In particular, it is
not subjected to XML or HTML escaping, it is not subjected to Unicode
Normalization, and it is not subjected to further character mapping.</p>
<p>Character mapping is not applied to characters in text <a title="node" href="#dt-node">nodes</a> whose parent elements are listed in the <code>cdata-section-elements</code> parameter, nor to characters for which output escaping has been disabled (disabling output escaping is an <a href="#xslt20">[XSL Transformations (XSLT) Version 2.0]</a> feature), nor to characters in attribute values that are subject to the <a title="URI Escaping" href="#uri-escaping">URI escaping</a> defined for the HTML and XHTML
output methods, unless <a title="URI Escaping" href="#uri-escaping">URI escaping</a> has been disabled using the <code>escape-uri-attributes</code> parameter in the output definition.</p>
<p>On serialization, occurrences of a character specified in the <code>use-character-maps</code> in text <a title="node" href="#dt-node">nodes</a> and attribute values are replaced by the corresponding string from the <code>use-character-maps</code> parameter.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Using a character map can result in non-well-formed documents if the
string contains XML-significant characters. For example, it is possible
to create documents containing unmatched start and end tags, references
to entities that are not declared, or attributes that contain tags or
unescaped quotation marks.</p>
</div>
<p>If a character is mapped, then it is not subjected to XML or HTML escaping.</p>
<p>A <a title="serialization error" href="#serial-err">serialization error</a> [<a title="err:SE0008" href="#ERRSE0008">err:SE0008</a>]
occurs if character mapping causes the output of a string containing a
character that cannot be represented in the encoding that the <a title="serializer" href="#serializer">serializer</a> is using for output. The <a title="serializer" href="#serializer">serializer</a> <strong>MUST</strong> signal the error.</p>
</div>
<div class="div1">
<h2><a id="conformance" name="conformance"></a>10 Conformance</h2>
<p>Serialization is intended primarily as a component that can be used
by other specifications. Therefore, this document relies on
specifications that use it to specify conformance criteria for
Serialization in their respective environments. Specifications that set
conformance criteria for their use of Serialization <strong>MUST NOT</strong>
change the semantic definitions of Serialization as given in this
specification, except by subsetting and/or compatible extensions. It is
the responsibility of the
<a title="host language" href="#host-language">host language</a> to specify how <a title="serialization error" href="#serial-err">serialization errors</a> should be handled.</p>
<p>Certain facilities in this specification are described as producing <a title="implementation-defined" href="#impdef">implementation-defined</a> results. A claim that asserts conformance with this specification <strong>MUST</strong>
be accompanied by documentation stating the effect of each
implementation-defined feature. For convenience, a non-normative
checklist of implementation-defined features is provided at <a href="#implementation-defined-features"><b>C Checklist of Implementation-Defined
Features</b></a>.</p>
</div>
</div>
<div class="back">
<div class="div1">
<h2><a id="N113E8" name="N113E8"></a>A References</h2>
<div class="div2">
<h3><a id="N113EB" name="N113EB"></a>A.1 Normative References</h3>
<dl>
<dt class="label"><span><a id="CHARMOD" name="CHARMOD"></a>Character Model for the World Wide Web 1.0: Normalization</span></dt>
<dd>
<div>World Wide Web Consortium, <em>Character Model for the World Wide Web 1.0: Normalization</em> See <a href="http://www.w3.org/TR/charmod-norm/">http://www.w3.org/TR/2004/WD-charmod-norm-20040225</a></div>
</dd>
<dt class="label"><span><a id="xpath-datamodel" name="xpath-datamodel"></a>XQuery 1.0 and XPath 2.0 Data Model</span></dt>
<dd>
<div><a href="http://www.w3.org/TR/xpath-datamodel/"><cite>XQuery 1.0 and XPath 2.0 Data Model</cite></a>, Marton Nagy, Norman Walsh, Mary Fernández, <em>et. al.</em>,
Editors. World Wide Web Consortium, 4 Apr&nbsp;2005. This version is
http://www.w3.org/TR/2005/WD-xpath-datamodel-20050404/. The <a href="http://www.w3.org/TR/xpath-datamodel/">latest version</a> is available at http://www.w3.org/TR/xpath-datamodel/.</div>
</dd>
<dt class="label"><span><a id="xpath-functions" name="xpath-functions"></a>XQuery 1.0 and XPath 2.0 Functions and Operators</span></dt>
<dd>
<div><a href="http://www.w3.org/TR/xpath-functions/"><cite>XQuery 1.0 and XPath 2.0 Functions and Operators</cite></a>,
Ashok Malhotra, Jim Melton, and Norman Walsh, Editors. World Wide Web
Consortium, 4 Apr&nbsp;2005. This version is
http://www.w3.org/TR/2005/WD-xpath-functions-20050404/. The <a href="http://www.w3.org/TR/xpath-functions/">latest version</a> is available at http://www.w3.org/TR/xpath-functions/.</div>
</dd>
<dt class="label"><span><a id="HTML" name="HTML"></a>HTML</span></dt>
<dd>
<div>World Wide Web Consortium. <em>HTML 4.01 specification</em>. W3C Recommendation. See <a href="http://www.w3.org/TR/html4/">http://www.w3.org/TR/html4/</a>.</div>
</dd>
<dt class="label"><span><a id="IANA" name="IANA"></a>IANA</span></dt>
<dd>
<div>Internet Assigned Numbers Authority. <em>Character Sets</em>. See <a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a>.</div>
</dd>
<dt class="label"><span><a id="RFC2046" name="RFC2046"></a>RFC2046</span></dt>
<dd>
<div>N. Freed, N. Borenstein. <em>Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</em>. IETF RFC 2046. See <a href="http://www.ietf.org/rfc/rfc2046.txt">http://www.ietf.org/rfc/rfc2046.txt</a>.</div>
</dd>
<dt class="label"><span><a id="RFC2119" name="RFC2119"></a>RFC2119</span></dt>
<dd>
<div>S. Bradner. <em>Key words for use in RFCs to Indicate Requirement Levels</em>. IETF RFC 2119. See <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>.</div>
</dd>
<dt class="label"><span><a id="RFC2278" name="RFC2278"></a>RFC2278</span></dt>
<dd>
<div>N. Freed, J. Postel. <em>IANA Charset Registration Procedures</em>. IETF RFC 2278. See <a href="http://www.ietf.org/rfc/rfc2278.txt">http://www.ietf.org/rfc/rfc2278.txt</a>.</div>
</dd>
<dt class="label"><span><a id="RFC2854" name="RFC2854"></a>RFC2854</span></dt>
<dd>
<div>D. Connolly, L. Masinter <em>The 'text/html' Media Type</em>. IETF RFC 2278. See <a href="http://www.ietf.org/rfc/rfc2854.txt">http://www.ietf.org/rfc/rfc2854.txt</a>.</div>
</dd>
<dt class="label"><span><a id="RFC3236" name="RFC3236"></a>RFC3236</span></dt>
<dd>
<div>M. Baker, P. Stark. <em>The 'application/xhtml+xml' Media Type</em>. IETF RFC 3236. See <a href="http://www.ietf.org/rfc/rfc3236.txt">http://www.ietf.org/rfc/rfc3236.txt</a>.</div>
</dd>
<dt class="label"><span><a id="UNICODE-ENCODING" name="UNICODE-ENCODING"></a>Unicode Encoding</span></dt>
<dd>
<div>Unicode Consortium. <em>Unicode Character Encoding Model</em>. Unicode Standard Annex #17. See <a href="http://www.unicode.org/unicode/reports/tr17/">http://www.unicode.org/unicode/reports/tr17/</a>.</div>
</dd>
<dt class="label"><span><a id="UNICODE-NORMALIZATION" name="UNICODE-NORMALIZATION"></a>UAX #15: Unicode Normalization Forms</span></dt>
<dd>
<div>Unicode Consortium. <em>Unicode Normalization Forms</em>. Unicode Standard Annex #15. See <a href="http://www.unicode.org/unicode/reports/tr15/">http://www.unicode.org/unicode/reports/tr15/</a>.</div>
</dd>
<dt class="label"><span><a id="XHTML10" name="XHTML10"></a>XHTML 1.0</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XHTML 1.0: The Extensible HyperText Markup Language (Second Edition).</em> W3C Recommendation. See <a href="http://www.w3.org/TR/xhtml1/">http://www.w3.org/TR/xhtml1/</a>.</div>
</dd>
<dt class="label"><span><a id="XHTML11" name="XHTML11"></a>XHTML 1.1</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XHTML 1.1: Module-Based XHTML.</em> W3C Recommendation. See <a href="http://www.w3.org/TR/xhtml11/">http://www.w3.org/TR/xhtml11/</a>.</div>
</dd>
<dt class="label"><span><a id="XML" name="XML"></a>XML10</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Extensible Markup Language (XML) 1.0 (Second Edition)</em> W3C Recommendation. See <a href="http://www.w3.org/TR/2000/REC-xml-20001006">http://www.w3.org/TR/2000/REC-xml-20001006</a>.</div>
</dd>
<dt class="label"><span><a id="XML11" name="XML11"></a>XML11</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Extensible Markup Language (XML) 1.1</em> W3C Recommendation. See <a href="http://www.w3.org/TR/2004/REC-xml11-20040204/">http://www.w3.org/TR/2004/REC-xml11-20040204/</a>.</div>
</dd>
<dt class="label"><span><a id="XMLNAMES" name="XMLNAMES"></a>XML Names</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Namespaces in XML.</em> W3C Recommendation. See <a href="http://www.w3.org/TR/REC-xml-names/">http://www.w3.org/TR/REC-xml-names/</a>.</div>
</dd>
<dt class="label"><span><a id="XMLNAMES11" name="XMLNAMES11"></a>XML Names 1.1</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Namespaces in XML 1.1.</em> W3C Recommendation. See <a href="http://www.w3.org/TR/xml-names11/">http://www.w3.org/TR/xml-names11/</a>.</div>
</dd>
<dt class="label"><span><a id="XLINK" name="XLINK"></a>XLink</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XML Linking Language (XLink).</em> W3C Recommendation. See <a href="http://www.w3.org/TR/2001/REC-xlink-20010627/">http://www.w3.org/TR/2001/REC-xlink-20010627/</a>.</div>
</dd>
<dt class="label"><span><a id="XMLSCHEMA" name="XMLSCHEMA"></a>XML Schema</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XML Schema Part 1: Structures</em> and <em>XML Schema Part 2: Data Types</em>. W3C Recommendation. See <a href="http://www.w3.org/TR/xmlschema-1/">http://www.w3.org/TR/xmlschema-1/</a> and <a href="http://www.w3.org/TR/xmlschema-2/">http://www.w3.org/TR/xmlschema-2/</a></div>
</dd>
<dt class="label"><span><a id="xpath20" name="xpath20"></a>XML Path Language (XPath) 2.0</span></dt>
<dd>
<div><a href="http://www.w3.org/TR/xpath20"><cite>XML Path Language (XPath) 2.0</cite></a>, Anders Berglund, Mary F. Fernández, Scott Boag, <em>et. al.</em>, Editors. World Wide Web Consortium, 4 Apr 2005. This version is http://www.w3.org/TR/2005/WD-xpath20-20050404. The <a href="http://www.w3.org/TR/xpath20">latest version</a> is available at http://www.w3.org/TR/xpath20.</div>
</dd>
<dt class="label"><span><a id="xquery" name="xquery"></a>XQuery 1.0: An XML Query Language</span></dt>
<dd>
<div><a href="http://www.w3.org/TR/xquery"><cite>XQuery 1.0: An XML Query Language</cite></a>, Scott Boag, Don Chamberlin, Mary F. Fernández, <em>et. al.</em>, Editors. World Wide Web Consortium, 4 Apr 2005. This version is http://www.w3.org/TR/2005/WD-xquery-20050404/. The <a href="http://www.w3.org/TR/xquery">latest version</a> is available at http://www.w3.org/TR/xquery.</div>
</dd>
<dt class="label"><span><a id="xslt20" name="xslt20"></a>XSL Transformations (XSLT) Version 2.0</span></dt>
<dd>
<div><a href="http://www.w3.org/TR/xslt20"><cite>XSL Transformations (XSLT) Version 2.0</cite></a>,
Michael Kay, Editor. World Wide Web Consortium, 4 Apr 2005. This
version is http://www.w3.org/TR/2005/WD-xslt20-20050404/. The <a href="http://www.w3.org/TR/xslt20">latest version</a> is available at http://www.w3.org/TR/xslt20.</div>
</dd>
</dl>
</div>
<div class="div2">
<h3><a id="N11564" name="N11564"></a>A.2 Non-normative References</h3>
<dl>
<dt class="label"><span><a id="xhtml-mod" name="xhtml-mod"></a>XHTML Modularization</span></dt>
<dd>
<div>World Wide Web Consortium, <em>Modularization of XHTML<sup>&#8482;</sup></em> See <a href="http://www.w3.org/TR/xhtml-modularization/">http://www.w3.org/TR/xhtml-modularization/</a>.</div>
</dd>
</dl>
</div>
</div>
<div class="div1">
<h2><a id="id-errors" name="id-errors"></a>B Summary of Error Conditions</h2>
<dl>
<dt><a name="ERRSE0001" id="ERRSE0001"></a>err:SE0001</dt>
<dd>
<p>It is a error [<a title="err:SE0001" href="#ERRSE0001">err:SE0001</a>] if an item in <em>S<sub>5</sub></em> in <a title="sequence normalization" href="#sequence-normalization">sequence normalization</a> is an attribute node or a namespace node.</p>
</dd>
<dt><a name="ERRSE0003" id="ERRSE0003"></a>err:SE0003</dt>
<dd>
<p>It is an error if the <a title="serializer" href="#serializer">serializer</a>
is unable to satisfy the rules for either a well-formed XML document
entity or a well-formed XML external general parsed entity, or both,
except for contents modified by the character expansion phase of
serialization.</p>
</dd>
<dt><a name="ERRSE0004" id="ERRSE0004"></a>err:SE0004</dt>
<dd>
<p>It is an error to specify the doctype-system parameter, or to specify the standalone parameter with a value other than <code>omit</code>, if the instance of the data model contains text nodes or multiple element nodes as children of the root node.</p>
</dd>
<dt><a name="ERRSE0005" id="ERRSE0005"></a>err:SE0005</dt>
<dd>
<p>It is an error if the serialized result would contain an <a href="http://www.w3.org/TR/REC-xml-names/#NT-NCName">NCName</a> <sup><small>Names</small></sup> that contains a character that is not permitted by the version of Namespaces in XML specified by the <code>version</code> parameter.</p>
</dd>
<dt><a name="ERRSE0006" id="ERRSE0006"></a>err:SE0006</dt>
<dd>
<p>It is an error if the <a title="serializer" href="#serializer">serializer</a> does not support the version of XML and the version of Namespaces in XML specified in the <code>version</code> parameter.</p>
</dd>
<dt><a name="ERRSE0007" id="ERRSE0007"></a>err:SE0007</dt>
<dd>
<p>It is an error if an output encoding other than <code>UTF-8</code> or <code>UTF-16</code> is requested and the <a title="serializer" href="#serializer">serializer</a> does not support that encoding.</p>
</dd>
<dt><a name="ERRSE0008" id="ERRSE0008"></a>err:SE0008</dt>
<dd>
<p>It is an error if a character that cannot be represented in the encoding that the <a title="serializer" href="#serializer">serializer</a>
is using for output appears in a context where character references are
not allowed (for example if the character occurs in the name of an
element).</p>
</dd>
<dt><a name="ERRSE0009" id="ERRSE0009"></a>err:SE0009</dt>
<dd>
<p>It is an error if the <code>omit-xml-declaration</code> parameter has the value <code>yes</code>, and the <code>standalone</code> attribute has a value other than <code>omit</code>; or the <code>version</code> parameter has a value other than <code>1.0</code> and the <code>doctype-system</code> parameter is specified.</p>
</dd>
<dt><a name="ERRSE0010" id="ERRSE0010"></a>err:SE0010</dt>
<dd>
<p>It is an error if the output method is <code>xml</code>, the value of the <code>undeclare-prefixes</code> parameter is <code>yes</code>, and the value of the <code>version</code> parameter is 1.0.</p>
</dd>
<dt><a name="ERRSE0011" id="ERRSE0011"></a>err:SE0011</dt>
<dd>
<p>It is a error if the value of the <code>normalization-form</code> parameter specifies a normalization form that is not supported by the <a title="serializer" href="#serializer">serializer</a>.</p>
</dd>
<dt><a name="ERRSE0012" id="ERRSE0012"></a>err:SE0012</dt>
<dd>
<p>It is an error if the value of the <code>normalization-form</code> parameter is <code>fully-normalized</code> and any relevant construct of the result begins with a combining character.</p>
</dd>
<dt><a name="ERRSE0013" id="ERRSE0013"></a>err:SE0013</dt>
<dd>
<p>It is an error if the <a title="serializer" href="#serializer">serializer</a> does not support the version of HTML specified by the <code>version</code> parameter.</p>
</dd>
<dt><a name="ERRSE0014" id="ERRSE0014"></a>err:SE0014</dt>
<dd>
<p>It is an error to use the HTML output method when characters which
are legal in XML but not in HTML, specifically the control characters
#x7F-#x9F, appear in the instance of the data model.</p>
</dd>
<dt><a name="ERRSE0015" id="ERRSE0015"></a>err:SE0015</dt>
<dd>
<p>It is an error to use the HTML output method when <code>&gt;</code> appears within a processing instruction in the data model instance being serialized.</p>
</dd>
<dt><a name="ERRSE0016" id="ERRSE0016"></a>err:SE0016</dt>
<dd>
<p>It is a an error if a parameter value is invalid for the defined domain.</p>
</dd>
</dl>
</div>
<div class="div1">
<h2><a id="implementation-defined-features" name="implementation-defined-features"></a>C Checklist of Implementation-Defined Features (Non-Normative)</h2>
<p>This appendix provides a summary of Serialization features whose effect is explicitly <a title="implementation-defined" href="#impdef">implementation-defined</a>. The conformance rules (see <a href="#conformance"><b>10 Conformance</b></a>) require vendors to provide documentation that explains how these choices have been exercised.</p>
<ol>
<li>For any <a title="implementation-defined" href="#impdef">implementation-defined</a> output method, it is <a title="implementation-defined" href="#impdef">implementation-defined</a> whether <a title="sequence normalization" href="#sequence-normalization">sequence normalization</a> process takes place. (See <a href="#serdm"><b>2 Sequence Normalization</b></a>)</li>
<li>If the namespace URI is non-null for the <code>method</code> serialization parameter, then the parameter specifies an <a title="implementation-defined" href="#impdef">implementation-defined</a> output method. (See <a href="#serparam"><b>3 Serialization Parameters</b></a>)</li>
<li>If the value of the <code>normalization-form</code> form parameter is not <code>NFC</code>, <code>NFD</code>, <code>NFKC</code>, <code>NFKD</code>, <code>fully-normalized</code>, or <code>none</code> then the meaning of the value and it's effect is <a title="implementation-defined" href="#impdef">implementation-defined</a>. (See <a href="#serphases"><b>4 Phases of Serialization</b></a>)</li>
<li>The effect of providing an option that allows the encoding phase to
be skipped, so that the result of serialization is a stream of Unicode
characters, is <a title="implementation-defined" href="#impdef">implementation-defined</a>. The <a title="serializer" href="#serializer">serializer</a> is not required to support such an option. (See <a href="#serphases"><b>4 Phases of Serialization</b></a>)</li>
<li>An <a title="serializer" href="#serializer">serializer</a> may provide an <a title="implementation-defined" href="#impdef">implementation-defined</a> mechanism to place CDATA sections in the <a title="result tree" href="#result-tree">result tree</a>. (See <a href="#XML_CDATA-SECTION-ELEMENTS"><b>5.1.4 XML Output Method: the cdata-section-elements Parameter</b></a>)</li>
</ol>
</div>
</div>
</body></html>