import xml

entryelem parent entry =
(letrec
  filename = (head entry)
  path = (append parent (cons '/' filename))
 in
  (if (isdir path)
    (xml:mkelem nil nil "dir" (cons (xml:mkattr nil nil "name" filename) nil) nil (procdir path))
    (xml:mkelem nil nil "file" (cons (xml:mkattr nil nil "name" filename) nil) nil nil)))

procdir path =
(map (entryelem path)
  (readdir path))

main =
(xml:printxml 1
  (xml:mkelem nil nil "result" nil nil
    (procdir "/home/peter/etc")))
